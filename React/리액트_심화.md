# ë¦¬ì•¡íŠ¸ ì‹¬í™”ë°˜

[ì´ë¡ í¸](%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A2%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%89%E1%85%B5%E1%86%B7%E1%84%92%E1%85%AA%E1%84%87%E1%85%A1%E1%86%AB%203919ac1335334519a0da4373744db222/%E1%84%8B%E1%85%B5%E1%84%85%E1%85%A9%E1%86%AB%E1%84%91%E1%85%A7%E1%86%AB%203e3e4429010e43fc8ff578353d24912e.md)

## Firebase Authentication

- ì—´ì–´ë³´ê¸°

    íŒŒì´ì–´ë² ì´ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ì¸ì¦ ê¸°ëŠ¥ìœ¼ë¡œ ë‹¤ì–‘í•œ ì†Œì…œ ë¡œê·¸ì¸ê³¼ íŒŒì´ì–´ë² ì´ìŠ¤ì— ì§ì ‘ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

    ![%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A2%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%89%E1%85%B5%E1%86%B7%E1%84%92%E1%85%AA%E1%84%87%E1%85%A1%E1%86%AB%203919ac1335334519a0da4373744db222/firebase-authentication.png](%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A2%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%89%E1%85%B5%E1%86%B7%E1%84%92%E1%85%AA%E1%84%87%E1%85%A1%E1%86%AB%203919ac1335334519a0da4373744db222/firebase-authentication.png)

    ```jsx
    // shared/firebase.js
    import firebase from "firebase/app";
    import "firebase/auth";

    const firebaseConfig = {
    // ì¸ì¦ì •ë³´!
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    export { auth };
    ```

## íšŒì›ê°€ì…

- ì‚¬ì „ ì¤€ë¹„
    - firebase.jsì—ì„œ auth ì„¤ì •í•˜ê¸°
    - Cookie.jsì—ì„œ ì¿ í‚¤ ìƒì„±, ê°€ì ¸ì˜¤ê¸°, ì‚­ì œ í•˜ëŠ” í•¨ìˆ˜ ë§Œë“¤ê¸°
- ë¦¬ë•ìŠ¤ ëª¨ë“ˆ ë§Œë“¤ê¸°

    ```jsx
    import { createAction, handleActions } from "redux-actions";
    import { produce } from "immer";

    import { setCookie, getCookie, deleteCookie } from "../../shared/Cookie";

    import { auth } from "../../shared/firebase";

    // actions
    const LOG_OUT = "LOG_OUT";
    const GET_USER = "GET_USER";
    const SET_USER = "SET_USER";

    // action creators
    const logOut = createAction(LOG_OUT, (user) => ({ user }));
    const getUser = createAction(GET_USER, (user) => ({ user }));
    const setUser = createAction(SET_USER, (user) => ({ user }));

    // initialState
    const initialState = {
      user: null,
      is_login: false,
    };

    // middleware actions
    const signupFB = (id, pwd, user_name) => {
      return function (dispatch, getState, {history}){

        auth
          .createUserWithEmailAndPassword(id, pwd)
          .then((user) => {

            console.log(user);
            
            auth.currentUser.updateProfile({
              displayName: user_name,
            }).then(()=>{
              dispatch(setUser({user_name: user_name, id: id, user_profile: ''}));
              history.push('/');
            }).catch((error) => {
              console.log(error);
            });

            // Signed in
            // ...
          })
          .catch((error) => {
            var errorCode = error.code;
            var errorMessage = error.message;

            console.log(errorCode, errorMessage);
            // ..
          });

      }
    }

    // reducer
    export default handleActions(
      {
        [SET_USER]: (state, action) =>
          produce(state, (draft) => {
            setCookie("is_login", "success");
            draft.user = action.payload.user;
            draft.is_login = true;
          }),
        [LOG_OUT]: (state, action) =>
          produce(state, (draft) => {
            deleteCookie("is_login");
            draft.user = null;
            draft.is_login = false;
          }),
        [GET_USER]: (state, action) => produce(state, (draft) => {}),
      },
      initialState
    );

    // action creator export
    const actionCreators = {
      logOut,
      getUser,
      signupFB,
    };

    export { actionCreators };
    ```

- íšŒì›ê°€ì… í˜ì´ì§€ì—ì„œ í˜¸ì¶œí•˜ê¸°
    - ì´ë©”ì¼ ì²´í¬ ì •ê·œ í‘œí˜„ì‹

        ```tsx
        // shared/common.js
        export const emailCheck = (email) => {
            let _reg = /^[0-9a-zA-Z]([-_.0-9a-zA-Z])*@[0-9a-zA-Z]([-_.0-9a-zA-z])*.([a-zA-Z])*/;

            return _reg.test(email);
        }
        ```

    ```jsx
    import React from "react";
    import { Grid, Text, Input, Button } from "../elements";

    import { useDispatch } from "react-redux";
    import { actionCreators as userActions } from "../redux/modules/user";
    import { emailCheck } from "../shared/common";

    const Signup = (props) => {
      const dispatch = useDispatch();

      const [id, setId] = React.useState("");
      const [pwd, setPwd] = React.useState("");
      const [pwd_check, setPwdCheck] = React.useState("");
      const [user_name, setUserName] = React.useState("");

      const signup = () => {
        if (id === "" || pwd === "" || user_name === "") {
          window.alert("ì•„ì´ë””, íŒ¨ìŠ¤ì›Œë“œ, ë‹‰ë„¤ì„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
          return;
        }

        if(!emailCheck(id)){
          window.alert('ì´ë©”ì¼ í˜•ì‹ì´ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤!');
          return;
        }
        
        if (pwd !== pwd_check) {
          window.alert("íŒ¨ìŠ¤ì›Œë“œì™€ íŒ¨ìŠ¤ì›Œë“œ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
          return;
        }

        dispatch(userActions.signupFB(id, pwd, user_name));
      };
      return (
        <React.Fragment>
          <Grid padding="16px">
            <Text size="32px" bold>
              íšŒì›ê°€ì…
            </Text>

            <Grid padding="16px 0px">
              <Input
                label="ì•„ì´ë””"
                placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."
                _onChange={(e) => {
                  setId(e.target.value);
                }}
              />
            </Grid>

            <Grid padding="16px 0px">
              <Input
                label="ë‹‰ë„¤ì„"
                placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
                _onChange={(e) => {
                  setUserName(e.target.value);
                }}
              />
            </Grid>

            <Grid padding="16px 0px">
              <Input
                label="ë¹„ë°€ë²ˆí˜¸"
                placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."
                _onChange={(e) => {
                  setPwd(e.target.value);
                }}
              />
            </Grid>

            <Grid padding="16px 0px">
              <Input
                label="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
                placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”."
                _onChange={(e) => {
                  setPwdCheck(e.target.value);
                }}
              />
            </Grid>

            <Button text="íšŒì›ê°€ì…í•˜ê¸°" _onClick={signup}></Button>
          </Grid>
        </React.Fragment>
      );
    };

    Signup.defaultProps = {};

    export default Signup;
    ```

## ë¡œê·¸ì¸

í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ì„œë²„ì— ë¡œê·¸ì¸ ìš”ì²­ì„ ë³´ë‚´ê³ , ì‘ë‹µì„ ë°›ì•„ì„œ í† í°ì„ ì €ì¥í•˜ë©´ ëì´ë‹¤.

- ë¡œê·¸ì¸í•œ ìƒíƒœì¼ ë•Œ í—¤ë” ë§Œë“¤ê¸°
    - ì¿ í‚¤ê°€ ìˆìœ¼ë©´ ë¡œê·¸ì¸í•œ í—¤ë” ë³´ì—¬ì£¼ê¸°
    - ë¡œê·¸ì•„ì›ƒì— ì¿ í‚¤ ì‚­ì œ í•¨ìˆ˜ ë„£ì–´ì£¼ê¸°

    ```jsx
    import React from "react";
    import {Grid, Text, Button} from "../elements";
    import {getCookie, deleteCookie} from "../shared/Cookie";
    const Header = (props) => {

        const [is_login, setIsLogin] = React.useState(false);

        React.useEffect(() => {

            // ì¿ í‚¤ë¥¼ ê°€ì ¸ì™€ìš”!
            let cookie = getCookie('ì¿ í‚¤ ì´ë¦„ ë„£ê¸°!');
            // í™•ì¸í•´ë´…ì‹œë‹¤!
            console.log(cookie);
            // ì¿ í‚¤ê°€ ìˆìœ¼ë©´?
            if(cookie){
                setIsLogin(true);
            }else{
                setIsLogin(false);
            }
        });

        if(is_login){
            return (
              <React.Fragment>
                <Grid is_flex padding="4px 16px">
                  <Grid>
                    <Text margin="0px" size="24px" bold>
                      í—¬ë¡œ
                    </Text>
                  </Grid>

                  <Grid is_flex>
                    <Button text="ë‚´ì •ë³´"></Button>
                    <Button text="ì•Œë¦¼"></Button>
                    <Button text="ë¡œê·¸ì•„ì›ƒ" _onClick={() => {deleteCookie('login');}}></Button>
                  </Grid>
                </Grid>
              </React.Fragment>
            );
        }
        return (
            <React.Fragment>
                <Grid is_flex padding="4px 16px">
                    <Grid>
                        <Text margin="0px" size="24px" bold>í—¬ë¡œ</Text>
                    </Grid>
                    
                    <Grid is_flex>
                        <Button text="ë¡œê·¸ì¸"></Button>
                        <Button text="íšŒì›ê°€ì…"></Button>
                    </Grid>
                </Grid>
            </React.Fragment>
        )
    }

    Header.defaultProps = {}

    export default Header;
    ```

- ë¦¬ë•ìŠ¤ ì„¤ì¹˜í•˜ê¸°

    ë§¤ë²ˆ ì¿ í‚¤ë¥¼ ì²´í¬í•˜ëŠ” ê²ƒë³´ë‹¤ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ë¦¬ë•ìŠ¤ì— ì €ì¥í•˜ê³  ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ì—ì„œë“  í¸í•˜ê²Œ ë³¼ ìˆ˜ ìˆê²Œ ë§Œë“ ë‹¤.

    ```jsx
    # ì´ê±´ ë¦¬ë•ìŠ¤ì™€ ë¦¬ë•ìŠ¤ ëª¨ë“ˆ ë‚´ì—ì„œ ê²½ë¡œ ì´ë™ê¹Œì§€ í•˜ê²Œ í•´ì¤„ íˆìŠ¤í† ë¦¬, ë¼ìš°í„°ì™€ íˆìŠ¤í† ë¦¬ë¥¼ ì—®ì–´ì¤„ ëª¨ë“ˆê¹Œì§€ í•œë²ˆì— ì„¤ì¹˜í•´ë³´ëŠ” ê±°ì˜ˆìš”.
    yarn add redux react-redux redux-thunk redux-logger history@4.10.1 connected-react-router@6.8.0
    ```

    ```jsx
    # í”„ë¡ íŠ¸ì—”ë“œì˜ ê½ƒ ë¦¬ì•¡íŠ¸ ê°•ì˜ì—ì„œëŠ” ë¦¬ë“€ì„œì—ì„œ ë­”ê°€ë¥¼ ë°”ê¿€ ë•Œ ë¶ˆë³€ì„± ê´€ë¦¬ë¥¼ ìš°ë¦¬ê°€ ì‹ ê²½ì¼ì£ .
    # ì´ë²ˆì—” ìš°ë¦¬ê°€ ì‹ ê²½ì“°ì§€ ë§ê³ , ì„ë¨¸ë¼ëŠ” íŒ¨í‚¤ì§€ ì‚¬ìš©í•´ì„œ í•´ë³¼ê±°ì˜ˆìš”.
    # ê·¸ë¦¬ê³  ì•¡ì…˜ë„ ë§¤ë²ˆ ë§¨ ìœ„ì—ì„œ user/CREATEì²˜ëŸ¼ ë¦¬ë“€ì„œ ëª¨ë“ˆ ëª…ì— ì–´ë–¤ íƒ€ì… ë„£ì–´ì„œ ë§Œë“¤ê³ , 
    # ê·¸ ì•„ë˜ì—ëŠ” ì•¡ì…˜ ìƒì„± í•¨ìˆ˜ ë§Œë“¤ì–´ì„œ export ë‹¤ í•´ì£¼ê³  ì¢€ ê·€ì°®ì•˜ì£ .
    # ì´ê±¸ redux-actionsë¼ëŠ” íŒ¨í‚¤ì§€ë¡œ ì¢€ ë” í¸í•˜ê²Œ ì“¸ê±°ì˜ˆìš”.
    yarn add immer redux-actions
    ```

- ìœ ì € ëª¨ë“ˆ ë§Œë“¤ê¸°
    - import
    - ì•¡ì…˜ íƒ€ì…
    - ì•¡ì…˜ ìƒì„± í•¨ìˆ˜
    - initialState
    - ë¦¬ë“€ì„œ
    - ì•¡ì…˜ ìƒì„± í•¨ìˆ˜ export
- ë¦¬ë•ìŠ¤ ìŠ¤í† ì–´ ë§Œë“¤ê¸°

    reduxì˜ `combineReducers()`ë¥¼ ì‚¬ìš©í•˜ì—¬ exportí•œ reducerë¥¼ ëª¨ì•„ root reducerë¥¼ ë§Œë“ ë‹¤.

    ë¯¸ë“¤ì›¨ì–´ë¥¼ ì ìš©í•´ì£¼ê³ , root reducerì™€ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì—®ì–´ reduxì˜ `createStore()`ë¡œ ìŠ¤í† ì–´ë¥¼ ë§Œë“ ë‹¤.

    ```jsx
    import { createStore, combineReducers, applyMiddleware, compose } from "redux";
    import thunk from "redux-thunk";
    import { createBrowserHistory } from "history";
    import { connectRouter } from "connected-react-router";

    import User from "./modules/user";

    export const history = createBrowserHistory();

    const rootReducer = combineReducers({
      user: User,
      router: connectRouter(history), // ìŠ¤í† ì–´ì— íˆìŠ¤í† ë¦¬ ë„£ì–´ì£¼ê¸°
    });

    // ë¯¸ë“¤ì›¨ì–´ ì¤€ë¹„
    // const middlewares = [thunk];
    const middlewares = [thunk.withExtraArgument({history: history})];

    // ì§€ê¸ˆì´ ì–´ëŠ í™˜ê²½ì¸ ì§€ ì•Œë ¤ì¤˜ìš”. (ê°œë°œí™˜ê²½, í”„ë¡œë•ì…˜(ë°°í¬)í™˜ê²½ ...)
    const env = process.env.NODE_ENV;

    // ê°œë°œí™˜ê²½ì—ì„œëŠ” ë¡œê±°ë¼ëŠ” ê±¸ í•˜ë‚˜ë§Œ ë” ì¨ë³¼ê²Œìš”.
    if (env === "development") {
      const { logger } = require("redux-logger");
      middlewares.push(logger);
    }

    // redux devTools ì„¤ì •
    const composeEnhancers =
      typeof window === "object" && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__
        ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({
            // Specify extensionâ€™s options like name, actionsBlacklist, actionsCreators, serialize...
          })
        : compose;

    // ë¯¸ë“¤ì›¨ì–´ ë¬¶ê¸°
    const enhancer = composeEnhancers(
      applyMiddleware(...middlewares)
    );

    // ë¯¸ë“¤ì›¨ì–´ì™€ ë£¨íŠ¸ ë¦¬ë“€ì„œë¥¼ ì—®ì–´ ìŠ¤í† ì–´ ë§Œë“¤ê¸°
    let store = (initialStore) => createStore(rootReducer, enhancer);

    export default store();
    ```

- ìŠ¤í† ì–´ ì£¼ì…í•˜ê¸°

    `Provider`ë¥¼ `index.js`ì—ì„œ ì£¼ì…í•˜ê³ , `App.js`ì—ì„œ ì›ë˜ `BrowserRouter`ì™€ `Route`ë¥¼ ì¨ì„œ ì»´í¬ë„ŒíŠ¸ì— ì£¼ì…í•˜ë˜ `history`ë¥¼ `ConnectedRouter`ë¥¼ ì¨ì„œ ë¦¬ë•ìŠ¤ë‘ ê°™ì€ historyë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•´ì¤€ë‹¤.

    ```jsx
    // index.js
    ...
    import store from "./redux/configureStore";
    import { Provider } from "react-redux";

    ReactDOM.render(
      <Provider store={store}>
        <App />
      </Provider>,
      document.getElementById("root")
    );
    ...
    ```

    ```jsx
    // App.js
    ...
    import { ConnectedRouter } from "connected-react-router";
    import { history } from "../redux/configureStore";
    ...
    function App() {
      return (
        <React.Fragment>
          <Grid>
            <Header></Header>
            <ConnectedRouter history={history}>
              <Route path="/" exact component={PostList} />
              <Route path="/login" exact component={Login} />
              <Route path="/signup" exact component={Signup}/>
            </ConnectedRouter>
          </Grid>
        </React.Fragment>
      );
    }
    ...
    ```

- ë¡œê·¸ì¸ ì•¡ì…˜ ì‹¤í–‰í•˜ê¸°

    ```jsx
    import React from "react";
    import { Text, Input, Grid, Button } from "../elements";
    import { getCookie, setCookie, deleteCookie } from "../shared/Cookie";

    import { useDispatch } from "react-redux";
    import { actionCreators as userActions } from "../redux/modules/user";

    const Login = (props) => {
      const dispatch = useDispatch();

      const [id, setId] = React.useState("");
      const [pwd, setPwd] = React.useState("");

      const login = () => {
        if(id === "" || pwd === ""){
          window.alert("ì•„ì´ë”” í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ê°€ ê³µë€ì…ë‹ˆë‹¤! ì…ë ¥í•´ì£¼ì„¸ìš”!");
          return;
        }

        dispatch(userActions.loginFB(id, pwd));
      };

      return (
        <React.Fragment>
          <Grid padding="16px">
            <Text size="32px" bold>
              ë¡œê·¸ì¸
            </Text>

            <Grid padding="16px 0px">
              <Input
                label="ì•„ì´ë””"
                placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."
                _onChange={(e) => {
                  setId(e.target.value);
                }}
              />
            </Grid>

            <Grid padding="16px 0px">
              <Input
                label="íŒ¨ìŠ¤ì›Œë“œ"
                placeholder="íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥í•´ì£¼ì„¸ìš”."
                type="password"
                _onChange={(e) => {
                  setPwd(e.target.value);
                }}
              />
            </Grid>

            <Button
              text="ë¡œê·¸ì¸í•˜ê¸°"
              _onClick={() => {
                console.log("ë¡œê·¸ì¸ í–ˆì–´!");
                login();
              }}
            ></Button>
          </Grid>
        </React.Fragment>
      );
    };

    export default Login;
    ```

- ë¦¬ë•ìŠ¤ì—ì„œ `auth.signInWithEmailAndPassword()`ë¡œ ë¡œê·¸ì¸ í•˜ëŠ” í•¨ìˆ˜ ë§Œë“¤ê¸°

    ```jsx
    import { createAction, handleActions } from "redux-actions";
    import { produce } from "immer";

    import { setCookie, getCookie, deleteCookie } from "../../shared/Cookie";

    import { auth } from "../../shared/firebase";
    import firebase from "firebase/app";

    // actions
    const LOG_OUT = "LOG_OUT";
    const GET_USER = "GET_USER";
    const SET_USER = "SET_USER";

    // action creators
    const logOut = createAction(LOG_OUT, (user) => ({ user }));
    const getUser = createAction(GET_USER, (user) => ({ user }));
    const setUser = createAction(SET_USER, (user) => ({ user }));

    // initialState
    const initialState = {
      user: null,
      is_login: false,
    };

    // middleware actions
    const loginFB = (id, pwd) => {
      return function (dispatch, getState, { history }) {
        auth.setPersistence(firebase.auth.Auth.Persistence.SESSION).then((res) => {
          auth
            .signInWithEmailAndPassword(id, pwd)
            .then((user) => {
              console.log(user);

              dispatch(
                setUser({
                  user_name: user.user.displayName,
                  id: id,
                  user_profile: "",
                  uid: user.user.uid,
                })
              );

              history.push("/");
            })
            .catch((error) => {
              var errorCode = error.code;
              var errorMessage = error.message;

              console.log(errorCode, errorMessage);
            });
        });
      };
    };

    const loginCheckFB = () => {
      return function (dispatch, getState, {history}){
        auth.onAuthStateChanged((user) => {
          if(user){
            dispatch(
              setUser({
                user_name: user.displayName,
                user_profile: "",
                id: user.email,
                uid: user.uid,
              })
            );
          }else{
            dispatch(logOut());
          }
        })
      }
    }

    // íŒŒì´ì–´ë² ì´ìŠ¤ ì¸ì¦ì—ì„œ ì œê³µí•˜ëŠ” ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ í•˜ë‚˜ë§Œ í˜¸ì¶œí•˜ë©´ ë!
    const logoutFB = () => {
      return function (dispatch, getState, {history}) {
        auth.signOut().then(() => {
          dispatch(logOut());
          history.replace('/');
        })
      }
    }

    // reducer
    export default handleActions(
      {
        [SET_USER]: (state, action) =>
          produce(state, (draft) => {
            setCookie("is_login", "success");
            draft.user = action.payload.user;
            draft.is_login = true;
          }),
        [LOG_OUT]: (state, action) =>
          produce(state, (draft) => {
            deleteCookie("is_login");
            draft.user = null;
            draft.is_login = false;
          }),
        [GET_USER]: (state, action) => produce(state, (draft) => {}),
      },
      initialState
    );

    // action creator export
    const actionCreators = {
      logOut,
      getUser,
      signupFB,
      loginFB,
      loginCheckFB,
      logoutFB,
    };

    export { actionCreators };
    ```

## ë¡œê·¸ì¸ ìœ ì§€

ì¿ í‚¤ì— ë¡œê·¸ì¸ ìœ ë¬´ë¥¼ ì €ì¥í•˜ì§€ ì•Šê³ , firebaseì˜ authë¥¼ í†µí•´ ê´€ë¦¬í•œë‹¤.

- ë¡œê·¸ì¸ ì‹œ, ì„¸ì…˜ì— ë¡œê·¸ì¸ ìƒíƒœë¥¼ ê¸°ë¡í•˜ë„ë¡ í•œë‹¤.

    ```tsx
    //user.js
    ...
    import firebase from "firebase/app";
    ...
    const loginFB = (id, pwd) => {
      return function (dispatch, getState, { history }) {
        auth.setPersistence(firebase.auth.Auth.Persistence.SESSION).then((res) => {
          auth
            .signInWithEmailAndPassword(id, pwd)
            .then((user) => {
              console.log(user);

              dispatch(
                setUser({
                  user_name: user.user.displayName,
                  id: id,
                  user_profile: "",
                  uid: user.user.uid,
                })
              );

              history.push("/");
            })
            .catch((error) => {
              var errorCode = error.code;
              var errorMessage = error.message;

              console.log(errorCode, errorMessage);
            });
        });
      };
    };

    ...
    ```

- firebase ì¸ì¦ í‚¤ë¥¼ export í•´ì¤€ë‹¤.

    ```tsx
    // src/shared/firebase.js
    export const apiKey = firebaseConfig.apiKey;
    ```

- ì„¸ì…˜ì„ ì²´í¬í•´ì„œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•œë‹¤.
    - Permit ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì–´ ë¡œê·¸ì¸ ì‹œì—ë§Œ ë³´ì´ë„ë¡ í•  ìˆ˜ ìˆë‹¤.

    ```tsx
    // src/shared/Permit.js
    import React from "react";
    import {useSelector} from "react-redux";
    import { apiKey } from "./firebase";

    const Permit = (props) => {
        // ìœ ì € ì •ë³´ê°€ ìˆëŠ” ì§€, í† í°ì´ ìˆëŠ” ì§€ë¥¼ ì²´í¬í•©ë‹ˆë‹¤!
        const user_info = useSelector(state => state.user.user);

        const _session_key = `firebase:authUser:${apiKey}:[DEFAULT]`;

        // ì„¸ì…˜ì´ ìˆë‚˜ í™•ì¸í•©ë‹ˆë‹¤
        const is_login = sessionStorage.getItem(_session_key);

        if(is_login && user_info){
            return <React.Fragment>{props.children}</React.Fragment>;    
        }

        return null;
    }

    export default Permit;
    ```

    ```jsx
    // src/components/common/Header.js
    ...
    import { apiKey } from "../../shared/firebase";
    ...

    const Header = React.memo((props) => {
     ...
      const _session_key = `firebase:authUser:${apiKey}:[DEFAULT]`;

      // ì„¸ì…˜ì´ ìˆë‚˜ í™•ì¸í•©ë‹ˆë‹¤
      const is_login = sessionStorage.getItem(_session_key);
    ...
    ```

- firebaseë¥¼ í†µí•´ ë¡œê·¸ì¸ ìƒíƒœê°€ ë§ë‚˜ í™•ì¸í•˜ì—¬ ìœ ì € ì •ë³´ë¥¼ ê°€ì ¸ë‹¤ ë„£ì–´ì¤€ë‹¤.

    ```jsx
    // user.js
    ...
    const loginCheckFB = () => {
      return function (dispatch, getState, {history}){
        auth.onAuthStateChanged((user) => {
          if(user){
            dispatch(
              setUser({
                user_name: user.displayName,
                user_profile: "",
                id: user.email,
                uid: user.uid,
              })
            );
          }else{
            dispatch(logOut());
          }
        })
      }
    }
    ...
    ```

    ```jsx
    // App.js
    ...
    function App() {
      const dispatch = useDispatch();

      const _session_key = `firebase:authUser:${apiKey}:[DEFAULT]`;
      const is_session = sessionStorage.getItem(_session_key)? true : false;
      
      React.useEffect(() => {
        
        if(is_session){
          dispatch(userActions.loginCheckFB());
        }

      }, []);

      return (
        <React.Fragment>
          <Grid>
            <Header></Header>
            <ConnectedRouter history={history}>
              <Route path="/" exact component={PostList} />
              <Route path="/login" exact component={Login} />
              <Route path="/signup" exact component={Signup} />
            </ConnectedRouter>
          </Grid>
        </React.Fragment>
      );
    }

    export default App;
    ```

## í¬ìŠ¤íŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°

- ë¦¬ë•ìŠ¤ ëª¨ë“ˆ ë§Œë“¤ê¸°
    - redux-actions, immer ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°

        â†’ `createAction`, `handleActions` í•¨ìˆ˜

        â†’ `produce` í•¨ìˆ˜

    - í•„ìš”í•œ ì•¡ì…˜ ë§Œë“¤ì–´ì£¼ê¸°

        : `createAction` ì„ ì´ìš©í•˜ì—¬ ì•¡ì…˜ í¬ë¦¬ì—ì´í„° ë§Œë“¤ê¸°

        ```tsx
        const SET_POST = "SET_POST";
        const setPost = createAction(SET_POST, (post_list) => ({post_list}));
        ```

    - initialState ë§Œë“¤ê¸°

        : ë™ì‹œì— ê²Œì‹œê¸€ í•˜ë‚˜ì— ëŒ€í•œ ë”ë¯¸ ë°ì´í„°ë„ ë§Œë“¤ì–´ ë†“ê¸°

    - ë¦¬ë“€ì„œ ì‘ì„±í•˜ê¸°

        ```tsx
        export default handleActions(
          {
              [SET_POST]: (state, action) => produce(state, (draft) => {
                
              }),
          },
          initialState
        );
        ```

    - ì•¡ì…˜ í¬ë¦¬ì—ì´í„°ë¥¼ ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ export í•˜ê¸°

        ```tsx
        const actionCreators = {
          setPost,
        };

        export { actionCreators };
        ```

- root ë¦¬ë“€ì„œì— post ë¦¬ë“€ì„œ ì¶”ê°€í•˜ê¸°
    - ìŠ¤í† ì–´ì— íˆìŠ¤í† ë¦¬ ë„£ì–´ì£¼ê¸° í¬í•¨ ([connected-react-router](https://github.com/supasate/connected-react-router))

    ```tsx
    // redux/configureStore.js
    ...
    import { combineReducers } from "redux";
    import Post from "./modules/post";
    import { connectRouter } from "connected-react-router";
    import { createBrowserHistory } from "history"; // react-router
    ...
    export const history = createBrowserHistory();
    const rootReducer = combineReducers({
      post: Post,
      router: connectRouter(history),
    });
    ...
    ```

- ê²Œì‹œê¸€ ëª©ë¡ í˜ì´ì§€ì— ì—°ë™í•˜ê¸°

    ```tsx
    // pages/PostList.js
    ...
    import {useSelector} from "react-redux";
    ...
    const PostList = (props) => {
    	const post_list = useSelector((state) => state.post.list);
    ...
    ```

- firestore ì—°ë™ ì¤€ë¹„í•˜ê¸°
    - firestoreì—ì„œ post ì»¬ë ‰ì…˜ ë§Œë“¤ê³  ë”ë¯¸ ë°ì´í„° ë„£ê¸°
    - firestore ì¶”ê°€í•˜ê¸°

        ```tsx
        // shared/firebase.js
        import "firebase/firestore";
        ...
        const firestore = firebase.firestore();
        ...
        export{ firestore };
        ```

- firestoreì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

    ```jsx
    //redux/modules/post.js
    import { firestore } from "../../shared/firebase";
    ...
    const getPostFB = () => {
      return function (dispatch, getState, { history }) {
        const postDB = firestore.collection("post");

        postDB.get().then((docs) => {
          let post_list = [];

          docs.forEach((doc) => {
            // ì˜ ê°€ì ¸ì™”ë‚˜ í™•ì¸í•˜ê¸°! :)
            // ì•—! DBì—ì„œ ê°€ì ¸ì˜¨ ê²ƒí•˜ê³  ìš°ë¦¬ê°€ Post ì»´í¬ë„ŒíŠ¸ì—ì„œ ì“°ëŠ” ë°ì´í„° ëª¨ì–‘ìƒˆê°€ ë‹¤ë¥´ë„¤ìš”!
            // console.log(doc.id, doc.data());

            // ë°ì´í„° ëª¨ì–‘ì„ ë§ì¶°ì£¼ì!
            let _post = doc.data();
            let post = {
                id: doc.id,
                user_info: {
                    user_name: _post.user_name,
                    user_profile: _post.user_profile,
                    user_id: _post.user_id,
                },
                contents: _post.contents,
                image_url: _post.image_url,
                comment_cnt: _post.comment_cnt,
                imsert_dt: _post.insert_dt
            }

            post_list.push(post);
          });

          // ë¦¬ìŠ¤íŠ¸ í™•ì¸í•˜ê¸°!
          console.log(post_list);

          dispatch(setPost(post_list));
        });
      };
    };
    ```

- ê²Œì‹œê¸€ ëª©ë¡ ì»´í¬ë„ŒíŠ¸(í˜ì´ì§€)ì—ì„œ í˜¸ì¶œí•˜ê¸°

    ```jsx
    // PostList.js
    import React from "react";

    import Post from "../components/Post";
    import {useSelector, useDispatch} from "react-redux";
    import {actionCreators as postActions} from "../redux/modules/post";

    const PostList = (props) => {
        const dispatch = useDispatch();
        const post_list = useSelector((state) => state.post.list);

        console.log(post_list);

        React.useEffect(() => {
            dispatch(postActions.getPostFB());

        }, []);

        return (
            <React.Fragment>
                {post_list.map((p, idx) => {

                    return <Post key={p.id} {...p}/>
                })}
            </React.Fragment>
        )
    }

    export default PostList;
    ```

## í¬ìŠ¤íŠ¸ ì‘ì„±í•˜ê¸°

ğŸ‘‰ í¬ìŠ¤íŠ¸ ì‘ì„± í›„ ëª©ë¡ í˜ì´ì§€ë¡œ ë˜ëŒì•„ ì™”ì„ ë•Œ, ëª©ë¡ì„ íŒŒì´ì–´ìŠ¤í† ì–´ë¡œ ê°€ì ¸ì˜¬ í•„ìš” ì—†ì´ ê·¸ëƒ¥ ì¶”ê°€í•œ ë°ì´í„°ë§Œ ë¦¬ë•ìŠ¤ì— ì¶”ê°€í•´ì£¼ë©´ ìš”ì²­ì„ í•˜ë‚˜ ëœ ë³´ë‚¼ ìˆ˜ ìˆë‹¤ëŠ” ì !

- ë¡œê·¸ì¸ ì—¬ë¶€ ì²´í¬í•˜ê¸°

    ```jsx
    // pages/PostWrite.js
    ...
    const PostWrite = (props) => {
      const is_login = useSelector((state) => state.user.is_login);
      const {history} = props;
      console.log(is_login);

      if(!is_login){
        return (
          <Grid margin="100px 0px" padding="16px" center>
            <Text size="32px" bold>
              ì•—! ì ê¹!
            </Text>
            <Text size="16px">
              ë¡œê·¸ì¸ í›„ì—ë§Œ ê¸€ì„ ì“¸ ìˆ˜ ìˆì–´ìš”!
            </Text>
            <Button
              _onClick={() => {
                history.replace("/login");
              }}
            >
              ë¡œê·¸ì¸ í•˜ëŸ¬ê°€ê¸°
            </Button>
          </Grid>
        );
      }
    ...
    ```

- ì‘ì„± í˜ì´ì§€ë¡œ ì´ë™í•˜ê¸°

    ```jsx
    // shared/App.js
    ...
    <Permit>
        <Button is_float text="+" _onClick={() => {history.push('/write');}}></Button>
    </Permit>
    ...
    ```

- firestoreì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜ ë§Œë“¤ê¸°

    ```jsx
    // redux/modules/post.js
    import moment from "moment";
    ...
    const initialPost = {
      image_url: "https://mean0images.s3.ap-northeast-2.amazonaws.com/4.jpeg",
      contents: "",
      comment_cnt: 0,
      insert_dt: moment().format("YYYY-MM-DD hh:mm:ss"),
    };
    ...
    const addPostFB = (contents = "") => {
      return function (dispatch, getState, { history }) {
        const postDB = firestore.collection("post");

        const _user = getState().user.user;
        const user_info = {
          user_name: _user.user_name,
          user_id: _user.uid,
          user_profile: _user.user_profile,
        };

        const _post = {
          ...initialPost,
          contents: contents,
          insert_dt: moment().format("YYYY-MM-DD hh:mm:ss")
        };
        // ì˜ ë§Œë“¤ì–´ì¡Œë‚˜ í™•ì¸í•´ë³´ì„¸ìš”!!
        console.log(_post);

        postDB.add({...user_info, ..._post}).then((doc) => {
            // ì•„ì´ë””ë¥¼ ì¶”ê°€í•´ìš”!
            let post = {user_info, ..._post, id: doc.id};
    				console.log(post);
        }).catch((err) => {
            console.log('post ì‘ì„± ì‹¤íŒ¨!', err);
        });
      };
    };
    ```

- ì‘ì„± ë²„íŠ¼ê³¼ ì—°ë™í•˜ê¸°

    ```jsx
    // pages/PostWrite.js
    ...
    import {useSelector, useDispatch} from "react-redux";
    import {actionCreators as postActions} from "../redux/modules/post";

    const PostWrite = (props) => {
      const dispatch = useDispatch();
     ...
      
      const addPost = () => {
        dispatch(postActions.addPostFB(contents));
      }
    ...

        return (
    	  ...
            <Grid padding="16px">
              <Button text="ê²Œì‹œê¸€ ì‘ì„±" _onClick={addPost}></Button>
            </Grid>
         ...
        );
    }

    export default PostWrite;
    ```

- ì €ì¥ ì„±ê³µ ì‹œ ë¦¬ë•ìŠ¤ì— ì¶”ê°€í•˜ê¸°

    ```jsx
    // redux/modules/post.js
    const addPostFB = (post, image = null) => {
      ...
    	postDB.add({...user_info, ..._post}).then((doc) => {
            // ì•„ì´ë””ë¥¼ ì¶”ê°€í•´ìš”!
            let post = {user_info, ..._post, id:doc.id};
            // ì´ì œ ë¦¬ë•ìŠ¤ì— ë„£ì–´ë´…ì‹œë‹¤.
            dispatch(addPost(post));
        }).catch((err) => {
            console.log('post ì‘ì„± ì‹¤íŒ¨!', err);
        });
    ...
    };
    ...
    [ADD_POST]: (state, action) => produce(state, (draft) => {
            // unshiftëŠ” ë°°ì—´ ë§¨ ì•ì— ë°ì´í„°ë¥¼ ë„£ì–´ì¤˜ìš”!
             draft.list.unshift(action.payload.post);
        }),
    ...
    ```

- ì‘ì„± í›„ í˜ì´ì§€ë¡œ ì´ë™í•˜ê¸°

    ```jsx
    	...
    	postDB.add({...user_info, ..._post}).then((doc) => {
            // ì•„ì´ë””ë¥¼ ì¶”ê°€í•´ìš”!
            let post = {...user_info, ..._post, id: doc.id};
            // ì´ì œ ë¦¬ë•ìŠ¤ì— ë„£ì–´ë´…ì‹œë‹¤.
            dispatch(addPost(post));
            history.replace("/");
        }).catch((err) => {
            console.log('post ì‘ì„± ì‹¤íŒ¨!', err);
        });
    	...
    ```

## ê²Œì‹œê¸€ ì‘ì„± ì‹œ ì´ë¯¸ì§€ ì—…ë¡œë“œí•˜ê¸° + í”„ë¦¬ë·° ë³´ì—¬ì£¼ê¸°

- firebase storage ì—°ê²°í•˜ê¸°

    ```jsx
    import firebase from "firebase/app";
    import "firebase/auth";
    import "firebase/firestore";
    import "firebase/storage";

    const firebaseConfig = {
      apiKey: "ì—¬ëŸ¬ë¶„ì˜ api keyë¥¼ ì—¬ê¸°ì—!",
      ... // ê·¸ ì™¸ ì„¤ì •ë“¤ì´ ì—¬ê¸°ì— ë“¤ì–´ê°€ìš”! apikeyì™€ í•¨ê»˜ ë„£ì–´ì£¼ì„¸ìš”!
    };

    firebase.initializeApp(firebaseConfig);

    const apiKey = firebaseConfig.apiKey;
    const auth = firebase.auth();
    const firestore = firebase.firestore();
    const storage = firebase.storage();

    export{auth, apiKey, firestore, storage};
    ```

- firebase ì½˜ì†”ì—ì„œ rules ì„¤ì •í•˜ê¸°

    ```jsx
    // íŒŒì´ì–´ë² ì´ìŠ¤ ì½˜ì†” -> Storageì—ì„œ ê·œì¹™(rules) íƒ­ìœ¼ë¡œ ì´ë™!ì•„ë˜ì²˜ëŸ¼ ë°”ê¿”ì£¼ê¸°!
    rules_version = '2';
    service firebase.storage {
      match /b/{bucket}/o {
        match /{allPaths=**} {
    			allow read, write: if request.auth != null;
        }
      }
    }
    ```

- ë¦¬ë•ìŠ¤ì— image ëª¨ë“ˆ ë§Œë“¤ê¸°
    - í•„ìš”í•œ ì•¡ì…˜ ë§Œë“¤ê¸°

        â†’ ì´ë¯¸ì§€ë¥¼ firebaseì— ì˜¬ë¦¬ê³ , ì—…ë¡œë“œ ì„±ê³µ ì‹œ ì—…ë¡œë“œí•œ íŒŒì¼ì˜ ë‹¤ìš´ë¡œë“œ ê²½ë¡œë¥¼ ê°€ì ¸ì™€ì„œ ë¦¬ë•ìŠ¤ì— ë„£ì–´ì£¼ëŠ” ì•¡ì…˜

        â†’ ì—…ë¡œë“œ ì¤‘ì—ëŠ” íŒŒì¼ ì„ íƒì„ ë§‰ì•„ì£¼ëŠ” ì•¡ì…˜

    - initialState ë§Œë“¤ê¸°
    - ë¦¬ë“€ì„œ ì‘ì„±í•˜ê¸°
    - ì•¡ì…˜ í¬ë¦¬ì—ì´í„°ë¥¼ ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ export í•˜ê¸°

    ```tsx
    import { createAction, handleActions } from "redux-actions";
    import produce from "immer";

    import { storage } from "../../shared/firebase";

    // actions
    const UPLOADING = "UPLOADING";
    const UPLOAD_IMAGE = "UPLOAD_IMAGE";

    // action creators
    const uploading = createAction(UPLOADING, (uploading) => ({ uploading }));
    const uploadImage = createAction(UPLOAD_IMAGE, (image_url) => ({ image_url }));

    function uploadImageFB(image) {
      return function (dispatch, getState, {history}) {
        
        dispatch(uploading(true));
        
        console.log(`images/${new Date().getTime()}_${image.name}`);
        const _upload = storage.ref(`images/${image.name}`).put(image);

        //   ì—…ë¡œë“œ!
        _upload.then((snapshot) => {
          console.log(snapshot);

          // ì—…ë¡œë“œí•œ íŒŒì¼ì˜ ë‹¤ìš´ë¡œë“œ ê²½ë¡œë¥¼ ê°€ì ¸ì˜¤ì!
          snapshot.ref.getDownloadURL().then((url) => {
            console.log(url);
            dispatch(uploadImage(url));
          });
        }).catch(err => {
            dispatch(uploading(false));
        });
      };
    }

    // initial state
    const initialState = {
      image_url: "http://via.placeholder.com/400x300",
      uploading: false,
    };

    // reducer
    export default handleActions(
      {
        [UPLOAD_IMAGE]: (state, action) =>
          produce(state, (draft) => {
            draft.image_url = action.payload.image_url;
            draft.uploading = false;
          }),

        [UPLOADING]: (state, action) =>
          produce(state, (draft) => {
            draft.uploading = action.payload.uploading;
          }),
      },
      initialState
    );

    const actionCreators = {
      uploadImage,
      uploadImageFB,
    };

    export { actionCreators };
    ```

- root ë¦¬ë“€ì„œì— image ë¦¬ë“€ì„œ ì¶”ê°€í•˜ê¸°

    ```jsx
    // src/redux/configureStore.js
    ...
    import Image from "./modules/image";
    ...

    const rootReducer = combineReducers({
      user: User,
      post: Post,
      image:Image,
      router: connectRouter(history),
    });
    ```

- ì´ë¯¸ì§€ ì—…ë¡œë“œ í•´ë³´ê¸°

    `<input type="file"/>`ì€ íŒŒì¼ ì„ íƒ ì‹œ `onChange` ì´ë²¤íŠ¸ì— ì„ íƒí•œ íŒŒì¼ì´ ê°ì²´ë¡œ ë„˜ì–´ì˜¨ë‹¤.

    ìœ ì €ê°€ `input`ìœ¼ë¡œ ë‚´ ì»´í“¨í„°ë¡œë¶€í„° ì—…ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•˜ë©´, ì¸í’‹ íƒœê·¸ëŠ” `FileList`ë¼ëŠ” ê°ì²´ì— íŒŒì¼ì„ ë‹´ì•„ ë³´ê´€í•œë‹¤.

    `FileList`ì— ìˆëŠ” íŒŒì¼ í•˜ë‚˜ í•˜ë‚˜ëŠ” `File` ê°ì²´ì´ë©°, ì´ `File` ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ firebaseì˜ storageì— íŒŒì¼ì„ ì—…ë¡œë“œí•œë‹¤.

    ```jsx
    import React from "react";
    import { useDispatch, useSelector } from "react-redux";
    import { Button } from "../elements";

    import { actionCreators as imageActions } from "../redux/modules/image";

    const Upload = (props) => {
      const dispatch = useDispatch();
      const uploading = useSelector((state) => state.image.uploading);
      const fileInput = React.useRef();

      const selectFile = (e) => {
        // e.targetì€ inputì´ì£ !
        // inputì´ ê°€ì§„ files ê°ì²´ë¥¼ ì‚´í´ë´…ì‹œë‹¤.
        console.log(e.target.files);
        // ì„ íƒí•œ íŒŒì¼ì´ ì–´ë–»ê²Œ ì €ì¥ë˜ì–´ ìˆë‚˜ ë´…ì‹œë‹¤.
        console.log(e.target.files[0]);

        // refë¡œë„ í™•ì¸í•´ë´…ì‹œë‹¤. :)
        console.log(fileInput.current.files[0]);
      };

      const uploadFB = () => {
        if (!fileInput.current || fileInput.current.files.length === 0) {
          window.alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
          return;
        }

        dispatch(imageActions.uploadImageFB(fileInput.current.files[0]));
      };

      return (
        <React.Fragment>
          <input
            type="file"
            ref={fileInput}
            onChange={selectFile}
            disabled={uploading}
          />
          <Button _onClick={uploadFB}>ì—…ë¡œë“œí•˜ê¸°</Button>
        </React.Fragment>
      );
    };

    export default Upload;
    ```

- í”„ë¦¬ë·° ë§Œë“¤ê¸°

    ê²Œì‹œê¸€ ì˜¬ë¦¬ê¸° ì „ê¹Œì§€ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ëª»í•˜ë©´ ë¶ˆí¸í•˜ë¯€ë¡œ ì´ë¯¸ì§€ ì„ íƒ ì‹œ ì„ íƒí•œ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆë„ë¡ í•œë‹¤.

    storageì— ì—…ë¡œë“œ í•˜ê³  ë³´ì—¬ì¤˜ë„ ë˜ì§€ë§Œ ì„ íƒí•œ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ì´ ì—¬ê¸°ì„œëŠ” ì¢€ ë” íš¨ìœ¨ì ì´ë‹¤.

    File ê°ì²´ëŠ” [FileReader](https://developer.mozilla.org/ko/docs/Web/API/FileReader)ë¡œ ì½ì–´ì˜¬ ìˆ˜ ìˆë‹¤.

    ```jsx
    // shared/Upload.js

    const selectFile = (e) => {
        // e.targetì€ inputì´ì£ !
        // inputì´ ê°€ì§„ files ê°ì²´ë¥¼ ì‚´í´ë´…ì‹œë‹¤.
        console.log(e.target.files);
        // ì„ íƒí•œ íŒŒì¼ì´ ì–´ë–»ê²Œ ì €ì¥ë˜ì–´ ìˆë‚˜ ë´…ì‹œë‹¤.
        console.log(e.target.files[0]);

        // refë¡œë„ í™•ì¸í•´ë´…ì‹œë‹¤. :)
        console.log(fileInput.current.files[0]);

        const reader = new FileReader();
        const file = e.target.files[0];

        // íŒŒì¼ ë‚´ìš©ì„ ì½ì–´ì˜µë‹ˆë‹¤.
        reader.readAsDataURL(file);

        // ì½ê¸°ê°€ ëë‚˜ë©´ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ˆìš”! :)
        reader.onloadend = () => {
          // reader.resultëŠ” íŒŒì¼ì˜ ì»¨í…ì¸ (ë‚´ìš©ë¬¼)ì…ë‹ˆë‹¤!
          console.log(reader.result);
        };
      };
    ```

- ë¦¬ë•ìŠ¤ image ëª¨ë“ˆì— ì•¡ì…˜, initialState, ë¦¬ë“€ì„œ ì—…ë°ì´íŠ¸í•˜ê¸°

    ```jsx
    // actions
    const UPLOADING = "UPLOADING";
    const UPLOAD_IMAGE = "UPLOAD_IMAGE";
    const SET_PREVIEW = "SET_PREVIEW";

    // action creators
    const uploading = createAction(UPLOADING, (uploading) => ({ uploading }));
    const uploadImage = createAction(UPLOAD_IMAGE, (image_url) => ({ image_url }));
    const setPreview = createAction(SET_PREVIEW, (preview) => ({ preview }));

    const initialState = {
      image_url: "",
      uploading: false,
      preview: null,
    };

    export default handleActions(
      {
        [UPLOAD_IMAGE]: (state, action) =>
          produce(state, (draft) => {
            draft.image_url = action.payload.image_url;
            draft.uploading = false;
          }),

        [UPLOADING]: (state, action) =>
          produce(state, (draft) => {
            draft.uploading = action.payload.uploading;
          }),

        [SET_PREVIEW]: (state, action) =>
          produce(state, (draft) => {
            draft.preview = action.payload.preview;
          }),
      },
      initialState
    );

    const actionCreators = {
      uploadImage,
      uploadImageFB,
      setPreview,
    };
    ```

- ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ì»´í¬ë„ŒíŠ¸ ì¶”ê°€í•˜ê¸°

    ```jsx
    // pages/PostWrite.js
    ...

    const PostWrite = (props) => {
      const dispatch = useDispatch();
      const is_login = useSelector((state) => state.user.is_login);
      const preview = useSelector((state) => state.image.preview);
      
    	...
        return (
          <React.Fragment>
    				...
              <Image
                shape="rectangle"
                src={preview ? preview : "http://via.placeholder.com/400x300"}
              />
            ...
          </React.Fragment>
        );
    }

    export default PostWrite;
    ```

- Upload.js Input ì»´í¬ë„ŒíŠ¸ì—ì„œ ì•¡ì…˜ dispatch í•˜ê¸°

    ```jsx
    // shared/Upload.js
    const selectFile = (e) => {
        // e.targetì€ inputì´ì£ !
        // inputì´ ê°€ì§„ files ê°ì²´ë¥¼ ì‚´í´ë´…ì‹œë‹¤.
        console.log(e.target.files);
        // ì„ íƒí•œ íŒŒì¼ì´ ì–´ë–»ê²Œ ì €ì¥ë˜ì–´ ìˆë‚˜ ë´…ì‹œë‹¤.
        console.log(e.target.files[0]);

        // refë¡œë„ í™•ì¸í•´ë´…ì‹œë‹¤. :)
        console.log(fileInput.current.files[0]);

        const reader = new FileReader();
        const file = e.target.files[0];

        // íŒŒì¼ ë‚´ìš©ì„ ì½ì–´ì˜µë‹ˆë‹¤.
        reader.readAsDataURL(file);

        // ì½ê¸°ê°€ ëë‚˜ë©´ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ˆìš”! :)
        reader.onloadend = () => {
          // reader.resultëŠ” íŒŒì¼ì˜ ì»¨í…ì¸ (ë‚´ìš©ë¬¼)ì…ë‹ˆë‹¤!
          console.log(reader.result);
          dispatch(imageActions.setPreview(reader.result));
        };
      };
    ```

- ê²Œì‹œê¸€ ì‘ì„± ì‹œ preview ê°€ì ¸ì˜¤ê¸°

    ```jsx
    const addPostFB = (contents = "") => {
      return function (dispatch, getState, { history }) {
        ...
    		// getState()ë¡œ storeì˜ ìƒíƒœê°’ì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ìš”!
        const _image = getState().image.preview;

    		// post.jsì—ì„œ í™•ì¸í•´ë´ìš”!
    		console.log(typeof _image);
    		...
      };
    };
    ```

- data_urlë¡œ íŒŒì¼ ì—…ë¡œë“œí•˜ê¸°

    [í•´ë‹¹ ê³µì‹ë¬¸ì„œ](https://firebase.google.com/docs/storage/web/upload-files?authuser=0)

    ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ê¸° ì „ì— ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•˜ê³  ì„±ê³µí–ˆì„ ë•Œë§Œ firestoreì— ê²Œì‹œê¸€ì„ ì €ì¥í•˜ê²Œ í•œë‹¤.

    ```tsx
    ...
    import {actionCreators as imageActions} from "./image";
    ...
    const addPostFB = (contents = "") => {
      return function (dispatch, getState, { history }) {
        const postDB = firestore.collection("post");

        const _user = getState().user.user;
        const user_info = {
          user_name: _user.user_name,
          user_id: _user.uid,
          user_profile: _user.user_profile,
        };

        const _post = {
          ...initialPost,
          contents: contents,
          insert_dt: moment().format("YYYY-MM-DD hh:mm:ss"),
        };

        // ì˜ ë§Œë“¤ì–´ì¡Œë‚˜ í™•ì¸í•´ë³´ì„¸ìš”!!
        console.log(_post);

        // getState()ë¡œ storeì˜ ìƒíƒœê°’ì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ìš”!
        const _image = getState().image.preview;

        // ë°ì´í„°ê°€ ì–´ë–¤ íƒ€ì…ì¸ì§€ í™•ì¸í•´ë´ìš”!
        console.log(typeof _image);

        // íŒŒì¼ ì´ë¦„ì€ ìœ ì €ì˜ idì™€ í˜„ì¬ ì‹œê°„ì„ ë°€ë¦¬ì´ˆë¡œ ë„£ì–´ì¤ì‹œë‹¤! (í˜¹ì‹œë¼ë„ ì¤‘ë³µì´ ìƒê¸°ì§€ ì•Šë„ë¡ìš”!)
        const _upload = storage
          .ref(`images/${user_info.user_id}_${new Date().getTime()}`)
          .putString(_image, "data_url");

        _upload
          .then((snapshot) => {
            snapshot.ref
              .getDownloadURL()
              .then((url) => {
                // urlì„ í™•ì¸í•´ë´ìš”!
                console.log(url);
                dispatch(imageActions.uploadImage(url));
                return url;
              })
              .then((url) => {
                // returnìœ¼ë¡œ ë„˜ê²¨ì¤€ ê°’ì´ ì˜ ë„˜ì–´ì™”ë‚˜ìš”? :)
                // ë‹¤ì‹œ ì½˜ì†”ë¡œ í™•ì¸í•´ì£¼ê¸°!
                console.log(url);

                postDB
                  .add({ ...user_info, ..._post, image_url: url })
                  .then((doc) => {
                    // ì•„ì´ë””ë¥¼ ì¶”ê°€í•´ìš”!
                    let post = { user_info, ..._post, id: doc.id, image_url: url };
                    // ì´ì œ ë¦¬ë•ìŠ¤ì— ë„£ì–´ë´…ì‹œë‹¤.
                    dispatch(addPost(post));
                    history.replace("/");
                  })
                  .catch((err) => {
    								window.alert("ì•—! í¬ìŠ¤íŠ¸ ì‘ì„±ì— ë¬¸ì œê°€ ìˆì–´ìš”!");
                    console.log("post ì‘ì„± ì‹¤íŒ¨!", err);
                  });
              });
          })
          .catch((err) => {
    				window.alert("ì•—! ì´ë¯¸ì§€ ì—…ë¡œë“œì— ë¬¸ì œê°€ ìˆì–´ìš”!");
            console.log(err);
          });
      };
    };
    ```

## ì´ë²¤íŠ¸ ê´€ë¦¬í•˜ê¸°

Lodashë¼ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ìœ í‹¸ë¦¬í‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ debounce, throttle ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì´ë²¤íŠ¸ë¥¼ ê´€ë¦¬í•œë‹¤.

LodashëŠ” ê·¸ ì™¸ì—ë„ ë°°ì—´ ê´€ë¦¬, ëª¨ë“ˆí™”, ì„±ëŠ¥ í–¥ìƒê³¼ ê´€ë ¨ëœ ê²ƒê¹Œì§€ ì—„ì²­ ë§ì€ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

### ì´ë²¤íŠ¸ê°€ ì—„ì²­ ë§ì´ ì¼ì–´ë‚˜ëŠ” ê²½ìš°

ê²€ìƒ‰ ì‹œ íƒ€ì´í•‘ í•  ë•Œë§ˆë‹¤ ê²€ìƒ‰ APIë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš°

â†’ íŠ¹ì • ì‹œê°„ë§ˆë‹¤ 1ë²ˆì”© í˜¸ì¶œí•˜ê±°ë‚˜ í‚¤ë³´ë“œ ì…ë ¥ì„ ë©ˆì·„ì„ ë•Œë§Œ 1ë²ˆ í˜¸ì¶œí•˜ë„ë¡ í•œë‹¤.

- debounce

    ì´ë²¤íŠ¸ê°€ ì¼ì–´ë‚˜ë©´, ì¼ì • ì‹œê°„ì„ ê¸°ë‹¤ë ¸ë‹¤ê°€ ì´ë²¤íŠ¸ë¥¼ ìˆ˜í–‰í•œë‹¤. ì¼ì • ì‹œê°„ ë‚´ì— ê°™ì€ ì´ë²¤íŠ¸ê°€ ë˜ ë“¤ì–´ì˜¤ë©´ ì´ì „ ìš”ì²­ì€ ì·¨ì†Œí•œë‹¤.

    ```jsx
    // shared/Search.js
    import React from "react";
    import _ from "lodash"; // lodash ë¶€ë¥´ê¸°

    const Search = () => {
      const debounce = _.debounce((k) => console.log("ë””ë°”ìš´ìŠ¤! :::", k), 1000);
      const keyPress = React.useCallback(debounce, []);

      const onChange = (e) => {
        keyPress(e.target.value);
      };

      return (
        <div>
          <label>Search:</label>
          <input onChange={onChange} />
        </div>
      );
    };

    export default Search;
    ```

- throttle

    ì¼ì • ì‹œê°„ ë™ì•ˆ ì¼ì–´ë‚œ ì´ë²¤íŠ¸ë¥¼ ëª¨ì•„ì„œ ì£¼ê¸°ì ìœ¼ë¡œ 1ë²ˆì”© ì‹¤í–‰í•œë‹¤.

    ```jsx
    // shared/Search.js
    import React from "react";
    import _ from "lodash"; // lodash ë¶€ë¥´ê¸°

    const Search = () => {
      const throttle = _.throttle((k) => console.log("ì“°ë¡œí‹€! :::", k), 1000);
      const keyPress = React.useCallback(throttle, []);

      const onChange = (e) => {
        keyPress(e.target.value);
      };

      return (
        <div>
          <label>Search:</label>
          <input onChange={onChange} />
        </div>
      );
    };

    export default Search;
    ```

## ë¬´í•œ ìŠ¤í¬ë¡¤

ê²Œì‹œê¸€ì„ í•œë²ˆì— ë§ì´ ê°€ì ¸ì˜¤ë©´ í˜ì´ì§€ ë¡œë“œ ì†ë„ê°€ ëŠë ¤ì§€ê¸° ë•Œë¬¸ì— í˜ì´ì§• ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤.

- initialStateì— ì¶”ê°€í•˜ê¸°

    throttleì€ ìš”ì²­ì„ ì—¬ëŸ¬ ë²ˆ ë³´ë‚¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— is_loadingì´ë¼ëŠ” íŒë³„ìê°€ í•˜ë‚˜ ë” í•„ìš”í•˜ë‹¤.

    ```jsx
    const initialState = {
      list: [],
      paging: { start: null, next: null, size: 3 },
      is_loading: false,
    };
    ```

- firebaseì—ì„œ í˜ì´ì§•ëŒ€ë¡œ ë°ì´í„° ê°€ì ¸ì˜¤ê²Œ í•˜ê¸°

    ```jsx
    const getPostFB = (start = null, size=3) => {
      return function (dispatch, getState, { history }) {

        // stateì—ì„œ í˜ì´ì§• ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        let _paging = getState().post.paging;

        // ì‹œì‘ì •ë³´ê°€ ê¸°ë¡ë˜ì—ˆëŠ”ë° ë‹¤ìŒ ê°€ì ¸ì˜¬ ë°ì´í„°ê°€ ì—†ë‹¤ë©´? ì•—, ë¦¬ìŠ¤íŠ¸ê°€ ëë‚¬ê² ë„¤ìš”!
        // ê·¸ëŸ¼ ì•„ë¬´ê²ƒë„ í•˜ì§€ë§ê³  returnì„ í•´ì•¼ì£ !
        if (_paging.start && !_paging.next) {
          return;
        }
        
        // ê°€ì ¸ì˜¤ê¸° ì‹œì‘~!
        dispatch(loading(true));
        
        const postDB = firestore.collection("post");

        let query = postDB.orderBy("insert_dt", "desc");

        // ì‹œì‘ì  ì •ë³´ê°€ ìˆìœ¼ë©´? ì‹œì‘ì ë¶€í„° ê°€ì ¸ì˜¤ë„ë¡ ì¿¼ë¦¬ ìˆ˜ì •!
        if(start){
          query = query.startAt(start);
        }

        // ì‚¬ì´ì¦ˆë³´ë‹¤ 1ê°œ ë” í¬ê²Œ ê°€ì ¸ì˜µì‹œë‹¤. 
        // 3ê°œì”© ëŠì–´ì„œ ë³´ì—¬ì¤€ë‹¤ê³  í•  ë•Œ, 4ê°œë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë©´? ì•— ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆê² ë„¤í•˜ê³  ì•Œ ìˆ˜ ìˆìœ¼ë‹ˆê¹Œìš”.
        // ë§Œì•½ 4ê°œ ë¯¸ë§Œì´ë¼ë©´? ë‹¤ìŒ í˜ì´ì§€ëŠ” ì—†ê² ì£ ! :)
        query.limit(size+1).get().then((docs) => {
          let post_list = [];

          // ìƒˆë¡­ê²Œ í˜ì´ì§• ì •ë³´ë¥¼ ë§Œë“¤ì–´ì¤˜ìš”.
          // ì‹œì‘ì ì—ëŠ” ìƒˆë¡œ ê°€ì ¸ì˜¨ ì •ë³´ì˜ ì‹œì‘ì ì„ ë„£ê³ ,
          // nextì—ëŠ” ë§ˆì§€ë§‰ í•­ëª©ì„ ë„£ìŠµë‹ˆë‹¤.
          // (ì´ nextê°€ ë‹¤ìŒë²ˆ ë¦¬ìŠ¤íŠ¸ í˜¸ì¶œ ë•Œ start íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¬ê±°ì˜ˆìš”.)
          let paging = {
            start: docs.docs[0],
            next: docs.docs.length === size+1? docs.docs[docs.docs.length - 1] : null,
            size: size,
          };

          docs.forEach((doc) => {
            let _post = doc.data();

            let post = Object.keys(_post).reduce(
              (acc, cur) => {
                if (cur.indexOf("user_") !== -1) {
                  return {
                    ...acc,
                    user_info: { ...acc.user_info, [cur]: _post[cur] },
                  };
                }
                return { ...acc, [cur]: _post[cur] };
              },
              { id: doc.id, user_info: {} }
            );

            post_list.push(post);
          });

          // ë§ˆì§€ë§‰ í•˜ë‚˜ëŠ” ë¹¼ì¤ë‹ˆë‹¤.
          // ê·¸ë˜ì•¼ sizeëŒ€ë¡œ ë¦¬ìŠ¤íŠ¸ê°€ ì¶”ê°€ë˜ë‹ˆê¹Œìš”!
          // ë§ˆì§€ë§‰ ë°ì´í„°ëŠ” ë‹¤ìŒ í˜ì´ì§€ì˜ ìœ ë¬´ë¥¼ ì•Œë ¤ì£¼ê¸° ìœ„í•œ ì¹œêµ¬ì¼ ë¿! ë¦¬ìŠ¤íŠ¸ì— ë“¤ì–´ê°€ì§€ ì•Šì•„ìš”!
          post_list.pop();

          dispatch(setPost(post_list, paging));
        });
      };
    };
    ```

- ë¦¬ë•ìŠ¤ì—ì„œë„ ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ë˜ë„ë¡ ë¦¬ë“€ì„œ ìˆ˜ì •í•˜ê¸°

    ```jsx
    [SET_POST]: (state, action) =>
          produce(state, (draft) => {
            draft.list.push(...action.payload.post_list);
            draft.paging = action.payload.paging;
            draft.is_loading = false;
          }),
    ```

- ê²Œì‹œê¸€ ëª©ë¡ í˜ì´ì§€ì— ì ìš©í•˜ê¸°

    ```jsx
    // PostList.js
    import React from "react";

    import Post from "../components/Post";
    import { useSelector, useDispatch } from "react-redux";
    import { actionCreators as postActions } from "../redux/modules/post";

    const PostList = (props) => {
      const dispatch = useDispatch();
      const post_list = useSelector((state) => state.post.list);
      const user_info = useSelector((state) => state.user.user);
      const is_loading = useSelector((state) => state.post.is_loading);
      const paging = useSelector((state) => state.post.paging);

      React.useEffect(() => {
        if(post_list.length === 0){
            dispatch(postActions.getPostFB());
        }
      }, []);

      return (
        <React.Fragment>
          
            {post_list.map((p, idx) => {
              if (user_info && p.user_info.user_id === user_info.uid) {
                return <Post key={p.id} {...p} is_me />;
              }
              return <Post key={p.id} {...p} />;
            })}
         
        </React.Fragment>
      );
    };

    export default PostList;
    ```

- InfinityScroll ì»´í¬ë„ŒíŠ¸ ë§Œë“¤ê¸°

    InfinityScrollì´ ì‘ìš©í•´ì•¼ í•˜ëŠ” ë²”ìœ„ë¥¼ ìƒê°í•´ë³¸ë‹¤.

    ```jsx
    import React from "react";

    import Spinner from "../elements/Spinner";
    import _ from "lodash";

    const InfinityScroll = (props) => {
      const { children, callNext, is_next, loading } = props;

      // ì“°ë¡œí‹€ì„ ì ìš©í•©ì‹œë‹¤!
      const _handleScroll = _.throttle(() => {
          callNext();
        }
      }, 300);

      const handleScroll = React.useCallback(_handleScroll, [loading]);

      React.useEffect(() => {
        // ë¡œë”© ì¤‘ì´ë©´, return!
        if (loading) {
          return;
        }

        // ë‹¤ìŒ ê²Œ ìˆìœ¼ë©´ ì´ë²¤íŠ¸ë¥¼ ë¶™ì´ê³ , ì—†ìœ¼ë©´ ì´ë²¤íŠ¸ë¥¼ ì‚­ì œí•´ìš”!
        if (is_next) {
          window.addEventListener("scroll", handleScroll);
        } else {
          window.removeEventListener("scroll", handleScroll);
        }

        // ì´ ë¶€ë¶„ì€ ì»´í¬ë„ŒíŠ¸ê°€ ì‚¬ë¼ì§ˆ ë•Œ í˜¸ì¶œë˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤! (í´ë¦°ì—…ì´ë¼ê³ ë„ í•´ìš”.)
        return () => window.removeEventListener("scroll", handleScroll);
      }, [is_next, loading]);

      return (
        <React.Fragment>
          {children}
    			{is_next && <Spinner />}
        </React.Fragment>
      );
    };

    InfinityScroll.defaultProps = {
      children: null,
      callNext: () => {},
      is_next: false,
      loading: false,
    };

    export default InfinityScroll;
    ```

- ê²Œì‹œê¸€ ëª©ë¡ í˜ì´ì§€ì— ì ìš©í•˜ê¸°

    ```jsx
    // PostList.js
    import React from "react";

    import Post from "../components/Post";
    import { useSelector, useDispatch } from "react-redux";
    import { actionCreators as postActions } from "../redux/modules/post";
    import InfinityScroll from "../shared/InfinityScroll";

    const PostList = (props) => {
      const dispatch = useDispatch();
      const post_list = useSelector((state) => state.post.list);
      const user_info = useSelector((state) => state.user.user);
      const is_loading = useSelector((state) => state.post.is_loading);
      const paging = useSelector((state) => state.post.paging);

      React.useEffect(() => {
        if(post_list.length === 0){
            dispatch(postActions.getPostFB());
        }
      }, []);

      return (
        <React.Fragment>
          <InfinityScroll
            callNext={() => {
              console.log("next!");
    					dispatch(postActions.getPostFB(paging.next));
            }}
            is_next={paging.next? true : false}
            loading={is_loading}
          >
            {post_list.map((p, idx) => {
              if (user_info && p.user_info.user_id === user_info.uid) {
                return <Post key={p.id} {...p} is_me />;
              }
              return <Post key={p.id} {...p} />;
            })}
          </InfinityScroll>
        </React.Fragment>
      );
    };

    export default PostList;
    ```

- ìŠ¤í¬ë¡¤ ê³„ì‚°í•˜ê¸°

    **window.innerHeight : ê°€ì‹œì ìœ¼ë¡œ ë³´ì´ëŠ” ë¸Œë¼ìš°ì € ì°½ ë†’ì´**

    **document.body.scrollHeight : ìŠ¤í¬ë¡¤ í•  ìˆ˜ ìˆëŠ” ë†’ì´**

    **document.documentElement.scrollTop : ìŠ¤í¬ë¡¤ì´ ì–¼ë§ˆë‚˜ ì›€ì§ì˜€ëŠ”ì§€ ì•Œë ¤ì£¼ëŠ” ê°’**

    ```jsx
    const _handleScroll = _.throttle(() => {
        const { innerHeight } = window;
        const { scrollHeight } = document.body;

        // ìŠ¤í¬ë¡¤ ê³„ì‚°!
        const scrollTop =
          (document.documentElement && document.documentElement.scrollTop) ||
          document.body.scrollTop;

        if (scrollHeight - innerHeight - scrollTop < 200) {
          // ë¡œë”© ì¤‘ì´ë©´ ë‹¤ìŒ ê±¸ ë¶€ë¥´ë©´ ì•ˆë˜ê² ì£ !
          if (loading) {
            return;
          }

          callNext();
        }
      }, 300);
    ```

- ìŠ¤í”¼ë„ˆ ë¶™ì´ê¸°

    ```jsx
    import React from "react";
    import styled from "styled-components";

    const Spinner = (props) => {
      const { type, size, is_dim } = props;

      return (
        <React.Fragment>
          <SpinnerWrap type={type} is_dim={is_dim}>
            <SpinnerSvg size={size} />
          </SpinnerWrap>
        </React.Fragment>
      );
    };

    Spinner.defaultProps = {
      type: "inline", // inline, page
      is_dim: false,
      size: 60,
    };

    const SpinnerWrap = styled.div`
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px 0;
      ${(props) =>
        props.type === "page"
          ? `position: fixed;
            height: 95vh;
            top: 0;
            left: 0;
            padding: 0;
            zIndex: 9999;`
          : ``}
      ${(props) =>
        props.is_dim
          ? `
         background: rgba(0,0,0,0.4); 
         height: 100vh;
      `
          : ``}
    `;

    const SpinnerSvg = styled.div`
      --size: ${(props) => props.size}px;
      width: var(--size);
      height: var(--size);
      background-image: url(\"data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' style='margin: auto; background: none; display: block; shape-rendering: auto;' width='200px' height='200px' viewBox='0 0 100 100' preserveAspectRatio='xMidYMid'%3E%3Cg transform='rotate(0 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='-0.9166666666666666s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3Cg transform='rotate(30 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='-0.8333333333333334s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3Cg transform='rotate(60 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='-0.75s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3Cg transform='rotate(90 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='-0.6666666666666666s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3Cg transform='rotate(120 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='-0.5833333333333334s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3Cg transform='rotate(150 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='-0.5s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3Cg transform='rotate(180 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='-0.4166666666666667s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3Cg transform='rotate(210 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='-0.3333333333333333s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3Cg transform='rotate(240 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='-0.25s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3Cg transform='rotate(270 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='-0.16666666666666666s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3Cg transform='rotate(300 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='-0.08333333333333333s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3Cg transform='rotate(330 50 50)'%3E%3Crect x='47' y='24' rx='3' ry='3.36' width='6' height='12' fill='%23222222'%3E%3Canimate attributeName='opacity' values='1;0' keyTimes='0;1' dur='1s' begin='0s' repeatCount='indefinite'%3E%3C/animate%3E%3C/rect%3E%3C/g%3E%3C/svg%3E\");
      background-size: var(--size);
    `;

    export default Spinner;
    ```

## ìƒì„¸ í˜ì´ì§€ ì—°ê²°í•˜ê¸°

- ê²Œì‹œê¸€ ëª©ë¡ í˜ì´ì§€ì—ì„œ onClick ë„˜ê²¨ì£¼ê³ , Grid ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‹¤í–‰í•˜ê¸°

    ```jsx
    // PostList.js
    import React from "react";
    import {useSelector, useDispatch} from "react-redux";

    import Post from "../components/Post";
    import {actionCreators as postActions} from "../redux/modules/post";
    import InfinityScroll from "../shared/InfinityScroll";
    import {Grid} from "../elements";

    const PostList = (props) => {
        const dispatch = useDispatch();
        const post_list = useSelector((state) => state.post.list);
        const user_info = useSelector((state) => state.user.user);
        const is_loading = useSelector((state) => state.post.is_loading);
        const paging = useSelector((state) => state.post.paging);

        const {history} = props;
        
        React.useEffect(() => {

            if(post_list.length === 0){
                 dispatch(postActions.getPostFB());
            }
           
        }, []);

        return (
          <React.Fragment>
            <Grid bg={"#EFF6FF"} padding="20px 0px">
              {/* <Post/> */}
              <InfinityScroll
                callNext={() => {
                  dispatch(postActions.getPostFB(paging.next));
                }}
                is_next={paging.next ? true : false}
                loading={is_loading}
              >
                {post_list.map((p, idx) => {
                  if (p.user_info.user_id === user_info?.uid) {
                    return (
                      <Grid
                        bg="#ffffff"
                        margin="8px 0px"
                        key={p.id}
                        _onClick={() => {
                          history.push(`/post/${p.id}`);
                        }}
                      >
                        <Post key={p.id} {...p} is_me />
                      </Grid>
                    );
                  } else {
                    return (
                      <Grid
    										key={p.id}
                        bg="#ffffff"
                        _onClick={() => {
                          history.push(`/post/${p.id}`);
                        }}
                      >
                        <Post {...p} />
                      </Grid>
                    );
                  }
                })}
              </InfinityScroll>
            </Grid>
          </React.Fragment>
        );
    }

    export default PostList;
    ```

- ë¦¬ë•ìŠ¤ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

    í•´ë‹¹ ê²Œì‹œê¸€ idë¥¼ ì´ìš©í•´ì„œ ë¦¬ë•ìŠ¤ë¡œë¶€í„° ê²Œì‹œê¸€ ì •ë³´ í•˜ë‚˜ë§Œ ê°€ì ¸ì˜¨ë‹¤.

    ```jsx
    import React from "react";
    import Post from "../components/Post";
    import CommentList from "../components/CommentList";
    import CommentWrite from "../components/CommentWrite";

    import {useSelector} from "react-redux";

    const PostDetail = (props) => {
        const id = props.match.params.id;

        const user_info = useSelector((state) => state.user.user);

        const post_list = useSelector(store => store.post.list);
        
        const post_idx = post_list.findIndex(p => p.id === id);
        const post = post_list[post_idx];

        return (
            <React.Fragment>
                <Post {...post} is_me={post.user_info.user_id === user_info.uid}/>
                <CommentWrite/>
                <CommentList/>
            </React.Fragment>
        )
    }

    export default PostDetail;
    ```

- ë¦¬ë•ìŠ¤ì— ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°, firestoreë¡œë¶€í„° ë‹¨ì¼ ê²Œì‹œê¸€ì„ ê°€ì ¸ì˜¤ê¸°

    ```jsx
    import React from "react";
    import Post from "../components/Post";
    import CommentList from "../components/CommentList";
    import CommentWrite from "../components/CommentWrite";

    import {useSelector} from "react-redux";

    import {firestore} from "../shared/firebase";

    const PostDetail = (props) => {
        const id = props.match.params.id;

        const user_info = useSelector((state) => state.user.user);

        const post_list = useSelector(store => store.post.list);
        
        const post_idx = post_list.findIndex(p => p.id === id);
        const post_data = post_list[post_idx];

        const [post, setPost] = React.useState(post_data? post_data : null);

        React.useEffect(() => {

            if(post){
               return; 
            }
            
            const postDB = firestore.collection("post");
            postDB.doc(id).get().then(doc => {
                console.log(doc);
                console.log(doc.data());
                
                let _post = doc.data();
                let post = Object.keys(_post).reduce(
                  (acc, cur) => {
                    if (cur.indexOf("user_") !== -1) {
                      return {
                        ...acc,
                        user_info: { ...acc.user_info, [cur]: _post[cur] },
                      };
                    }
                    return { ...acc, [cur]: _post[cur] };
                  },
                  { id: doc.id, user_info: {} }
                );

                setPost(post);
            })

        }, []);

        return (
          <React.Fragment>
            {post && (
              <Post {...post} is_me={post.user_info.user_id === user_info.uid} />
            )}
            <CommentWrite />
            <CommentList />
          </React.Fragment>
        );
    }

    export default PostDetail;
    ```

## ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°

- firestoreì— ëŒ“ê¸€ ì»¬ë ‰ì…˜(/comment) ë§Œë“¤ê¸°
    - contents, insert_dt, post_id, user_id, user_name, user_profile ë„£ê¸°
    - ë³µí•© ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ìƒ‰ì¸ ì¶”ê°€ (ì„¤ì •í•˜ê³  ë°˜ì˜ë˜ê¸°ê¹Œì§€ ì‹œê°„ ì†Œìš”)
- ë¦¬ë•ìŠ¤ ëª¨ë“ˆ ë§Œë“¤ê¸°
    - import, ì•¡ì…˜ íƒ€ì…, ì•¡ì…˜ ìƒì„±ì, initialState, ë¦¬ë“€ì„œ, export
    - ë£¨íŠ¸ ë¦¬ë“€ì„œì— ì¶”ê°€ê¹Œì§€ í•˜ê¸°

    ```tsx
    // redux/modules/comment.js

    import { createAction, handleActions } from "redux-actions";
    import { produce } from "immer";
    import { firestore } from "../../shared/firebase";
    import "moment";
    import moment from "moment";

    const SET_COMMENT = "SET_COMMENT";
    const ADD_COMMENT = "ADD_COMMENT";

    const LOADING = "LOADING";

    const setComment = createAction(SET_COMMENT, (post_id, comment_list) => ({post_id, comment_list}));
    const addComment = createAction(ADD_COMMENT, (post_id, comment) => ({post_id, comment}));

    const loading = createAction(LOADING, (is_loading) => ({ is_loading }));

    const initialState = {
      list: {},
      is_loading: false,
    };

    const getCommentFB = (post_id) => {
        return function(dispatch, getState, {history}){

        }
    }

    export default handleActions(
      {
          [SET_COMMENT]: (state, action) => produce(state, (draft) => {

          }),
          [ADD_COMMENT]: (state, action) => produce(state, (draft)=> {

          }),
          [LOADING]: (state, action) => 
          produce(state, (draft) => {
            draft.is_loading = action.payload.is_loading;
          })
      },
      initialState
    );

    const actionCreators = {
      getCommentFB,
      setComment,
      addComment,
    };

    export { actionCreators };
    ```

- ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ ê³ ì¹˜ê¸°

    firestore ë°ì´í„°ë¥¼ ë¦¬ë•ìŠ¤ì— ë„£ì–´ë‘ë„ë¡ ìˆ˜ì •í•œë‹¤.

    â†’ `redux/modules/post.js` ì—ì„œ ê²Œì‹œê¸€ í•˜ë‚˜ ì •ë³´ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ ë§Œë“¤ê¸°

    ```jsx
    ...
    const getOnePostFB = (id) => {
      return function(dispatch, getState, {history}){
        const postDB = firestore.collection("post");
        postDB
          .doc(id)
          .get()
          .then((doc) => {
            let _post = doc.data();

            if (!_post) {
              return;
            }

            let post = Object.keys(_post).reduce(
              (acc, cur) => {
                if (cur.indexOf("user_") !== -1) {
                  return {
                    ...acc,
                    user_info: { ...acc.user_info, [cur]: _post[cur] },
                  };
                }
                return { ...acc, [cur]: _post[cur] };
              },
              { id: doc.id, user_info: {} }
            );

            dispatch(setPost([post], { start: null, next: null, size: 3 }));
          });
      }
    }
    ...

    export default handleActions(
      {
       [SET_POST]: (state, action) =>
          produce(state, (draft) => {

            draft.list.push(...action.payload.post_list);

            // post_idê°€ ê°™ì€ ì¤‘ë³µ í•­ëª©ì„ ì œê±°í•©ì‹œë‹¤! :)
            draft.list = draft.list.reduce((acc, cur) => {
              // findIndexë¡œ ëˆ„ì‚°ê°’(cur)ì— í˜„ì¬ê°’ì´ ì´ë¯¸ ë“¤ì–´ìˆë‚˜ í™•ì¸í•´ìš”!
              // ìˆìœ¼ë©´? ë®ì–´ì“°ê³ , ì—†ìœ¼ë©´? ë„£ì–´ì£¼ê¸°!
              if (acc.findIndex((a) => a.id === cur.id) === -1){
                return [...acc, cur];
              }else{
                acc[acc.findIndex((a) => a.id === cur.id)] = cur;
                return acc;
              }
            }, []);

    				// pagingì´ ìˆì„ ë•Œë§Œ ë„£ê¸°
            if (action.payload.paging) {
              draft.paging = action.payload.paging;
            }
            draft.is_loading = false;
          }),
       ...
      },
      initialState
    );

    const actionCreators = {
      setPost,
      addPost,
      editPost,
      getPostFB,
      addPostFB,
      editPostFB,
      getOnePostFB,
    };
    ...
    ```

- ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ì— ì ìš©í•˜ê¸°

    ```jsx
    import React from "react";
    import Post from "../components/Post";
    import CommentList from "../components/CommentList";
    import CommentWrite from "../components/CommentWrite";

    import { useSelector, useDispatch } from "react-redux";

    import {actionCreators as postActions} from "../redux/modules/post";

    const PostDetail = (props) => {
      const dispatch = useDispatch();
      const id = props.match.params.id;

      const user_info = useSelector((state) => state.user.user);

      const post_list = useSelector((store) => store.post.list);

      const post_idx = post_list.findIndex((p) => p.id === id);
      const post = post_list[post_idx];

      React.useEffect(() => {
        if (post) {
          return;
        }

        dispatch(postActions.getOnePostFB(id));
      }, []);

      return (
        <React.Fragment>
          {post && (
            <Post {...post} is_me={post.user_info.user_id === user_info?.uid} />
          )}
          <CommentWrite post_id={id} />
          <CommentList post_id={id} />
        </React.Fragment>
      );
    };

    export default PostDetail;
    ```

- ê²Œì‹œê¸€ ëª©ë¡ í˜ì´ì§€ ì²« ì§„ì… ì‹œ, ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¡°ê±´ ë°”ê¿”ì£¼ê¸°

    ```jsx
    // pages/PostList.js
    ...
    React.useEffect(() => {
    // ê°€ì§€ê³  ìˆëŠ” ë°ì´í„°ê°€ 0ê°œ, 1ê°œì¼ ë•Œë§Œ ìƒˆë¡œ ë°ì´í„°ë¥¼ í˜¸ì¶œí•´ìš”.
        if (post_list.length < 2) {
          dispatch(postActions.getPostFB());
        }
      }, []);
    ...
    ```

- ê²Œì‹œê¸€ id, ì‘ì„± ì¼ì‹œ ì—­ìˆœìœ¼ë¡œ ì •ë ¬í•´ì„œ ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°

    ```jsx
    const getCommentFB = (post_id = null) => {
      return function (dispatch, getState, { history }) {
        const commentDB = firestore.collection("comment");
    		
    		// post_idê°€ ì—†ìœ¼ë©´ ë°”ë¡œ ë¦¬í„´í•˜ê¸°!
        if(!post_id){
            return;
        }

        // whereë¡œ ê²Œì‹œê¸€ idê°€ ê°™ì€ ê±¸ ì°¾ê³ ,
        // orderByë¡œ ì •ë ¬í•´ì¤ë‹ˆë‹¤.
        commentDB
          .where("post_id", "==", post_id)
          .orderBy("insert_dt", "desc")
          .get()
          .then((docs) => {
            let list = [];
            docs.forEach((doc) => {
              list.push({ ...doc.data(), id: doc.id });
            });
            //   ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ì!
            dispatch(setComment(post_id, list));
          }).catch(err => {
              console.log("ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨!", post_id, err);
          });
      };
    };
    ```

- ë¦¬ë“€ì„œ ì‘ì„±í•˜ê¸°

    ```jsx
    [SET_COMMENT]: (state, action) =>
          produce(state, (draft) => {
            // commentëŠ” ë”•ì…”ë„ˆë¦¬ êµ¬ì¡°ë¡œ ë§Œë“¤ì–´ì„œ,
            // post_idë¡œ ë‚˜ëˆ  ë³´ê´€í•©ì‹œë‹¤! (ê°ê° ê²Œì‹œê¸€ ë°©ì„ ë§Œë“¤ì–´ì¤€ë‹¤ê³  ìƒê°í•˜ë©´ êµ¬ì¡° ì´í•´ê°€ ì‰¬ì›Œìš”.)
            draft.list[action.payload.post_id] = action.payload.comment_list;
          }),
    ```

- CommentListì—ì„œ ë¶€ë¥´ê¸°

    ```jsx
    // components/CommentList.js
    import React from "react";
    import {Grid, Image, Text} from "../elements";

    import {useDispatch, useSelector} from "react-redux";
    import {actionCreators as commentActions} from "../redux/modules/comment";

    const CommentList = (props) => {
      const dispatch = useDispatch();
      const comment_list = useSelector(state => state.comment.list);
      
      const {post_id} = props;

      React.useEffect(() => {
        if(!comment_list[post_id]){
          // ì½”ë©˜íŠ¸ ì •ë³´ê°€ ì—†ìœ¼ë©´ ë¶ˆëŸ¬ì˜¤ê¸°
          dispatch(commentActions.getCommentFB(post_id));
        }
      }, []);

      // commentê°€ ì—†ê±°ë‚˜, post_idê°€ ì—†ìœ¼ë©´ ì•„ë¬´ê²ƒë„ ì•ˆë„˜ê²¨ì¤€ë‹¤!
      if(!comment_list[post_id] || !post_id){
        return null;
      }

      return (
        <React.Fragment>
          <Grid padding="16px">
            {comment_list[post_id].map(c => {
              return (<CommentItem key={c.id} {...c}/>);
            })}
          </Grid>
        </React.Fragment>
      );
    };

    CommentList.defaultProps = {
      post_id: null
    };

    export default CommentList;

    const CommentItem = (props) => {

        const {user_profile, user_name, user_id, post_id, contents, insert_dt} = props;
        return (
            <Grid is_flex>
                <Grid is_flex width="auto">
                    <Image shape="circle"/>
                    <Text bold>{user_name}</Text>
                </Grid>
                <Grid is_flex margin="0px 4px">
                    <Text margin="0px">{contents}</Text>
                    <Text margin="0px">{insert_dt}</Text>
                </Grid>
            </Grid>
        )
    }

    CommentItem.defaultProps = {
        user_profile: "",
        user_name: "mean0",
        user_id: "",
        post_id: 1,
        contents: "ê·€ì—¬ìš´ ê³ ì–‘ì´ë„¤ìš”!",
        insert_dt: '2021-01-01 19:00:00'
    }
    ```

## ëŒ“ê¸€ ì‘ì„±í•˜ê¸°

- ëŒ“ê¸€ ì…ë ¥í•˜ë©´ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°

    ```jsx
    // components/CommentWrite.js
    import React from "react";
    import Post from "../components/Post";
    import CommentList from "../components/CommentList";
    import CommentWrite from "../components/CommentWrite";

    import { useSelector } from "react-redux";

    import { firestore } from "../shared/firebase";

    const PostDetail = (props) => {
     ...
      const [contents, setContents] = React.useState("");
     ...
      

      const write = () => {
          if(contents === ""){
              window.alert("ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
          }
    			console.log(comment_text);
      }

      return (
        <React.Fragment>
          {post && (
            <Post {...post} is_me={post.user_info.user_id === user_info.uid} />
          )}
          <CommentWrite
            _onChange={(e) => {
              setContents(e.target.value);
            }}
            _onClick={write}
          />
          <CommentList />
        </React.Fragment>
      );
    };

    export default PostDetail;
    ```

- firebaseì— ëŒ“ê¸€ ì •ë³´ ì¶”ê°€í•œ ë’¤ í•´ë‹¹ ê²Œì‹œê¸€ì—ë„ ëŒ“ê¸€ ê°¯ìˆ˜ ì—…ë°ì´íŠ¸í•˜ê¸°

    ```jsx
    const addCommentFB = (post_id, contents) => {
      return function (dispatch, getState, { history }) {
        const commentDB = firestore.collection("comment");
        const user_info = getState().user.user;

        let comment = {
          post_id: post_id,
          user_id: user_info.uid,
          user_name: user_info.user_name,
          user_profile: user_info.user_profile,
          contents: contents,
          insert_dt: moment().format("YYYY-MM-DD hh:mm:ss"),
        };

        // firestoreì— ì½”ë©˜íŠ¸ ì •ë³´ë¥¼ ë„£ì–´ìš”!
        commentDB.add(comment).then((doc) => {
          const postDB = firestore.collection("post");
          comment = { ...comment, id: doc.id };

          const post = getState().post.list.find((l) => l.id === post_id);

          //   firestoreì— ì €ì¥ëœ ê°’ì„ +1í•´ì¤ë‹ˆë‹¤!
          const increment = firebase.firestore.FieldValue.increment(1);
          
          // postì—ë„ comment_cntë¥¼ í•˜ë‚˜ í”ŒëŸ¬ìŠ¤ í•´ì¤ë‹ˆë‹¤.
          postDB
            .doc(post_id)
            .update({ comment_cnt: increment })
            .then((_post) => {
              dispatch(addComment(post_id, comment));
              // ë¦¬ë•ìŠ¤ì— postê°€ ìˆì„ ë•Œë§Œ postì˜ comment_cntë¥¼ +1í•´ì¤ë‹ˆë‹¤.
              if (post) {
                dispatch(
                  postActions.editPost(post_id, {
                    comment_cnt: parseInt(post.comment_cnt) + 1,
                  })
                );
              }
            });
        });
      };
    };
    ```

- ë¦¬ë“€ì„œ ì‘ì„±í•˜ê¸°

    ```jsx
    [ADD_COMMENT]: (state, action) => produce(state, (draft) => {
            draft.list[action.payload.post_id].push(action.payload.comment);
        }),
    ```

- ëŒ“ê¸€ ì‘ì„± ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¶€ë¥´ê¸°

    ```jsx
    //components/CommentWrite.js
    import React from "react";

    import { Grid, Input, Button } from "../elements";

    import { useDispatch } from "react-redux";
    import { actionCreators as commentActions } from "../redux/modules/comment";

    const CommentWrite = (props) => {
      const dispatch = useDispatch();

      const { post_id } = props;

      const [comment_text, setCommentText] = React.useState("");

      const write = () => {
        if (comment_text === "") {
          window.alert("ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
          return;
        }
        // ì…ë ¥ëœ í…ìŠ¤íŠ¸ëŠ” ì§€ìš°ê¸°!
        setCommentText("");

        // íŒŒì´ì–´ìŠ¤í† ì–´ì— ì¶”ê°€í•©ë‹ˆë‹¤.
        dispatch(commentActions.addCommentFB(post_id, comment_text));
      };

      return (
        <React.Fragment>
          <Grid padding="16px" is_flex>
            <Input
              placeholder="ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš” :)"
              _onChange={onChange}
              value={comment_text}
              onSubmit={write}
              is_submit
            />
            <Button width="50px" margin="0px 2px 0px 2px" _onClick={write}>
              ì‘ì„±
            </Button>
          </Grid>
        </React.Fragment>
      );
    };

    CommentWrite.defaultProps = {
      post_id: "",
    };

    export default CommentWrite;
    ```

- ì—”í„° í‚¤ ì…ë ¥ ì‹œ ëŒ“ê¸€ì´ ì…ë ¥ë˜ë„ë¡ ë§Œë“¤ê¸°

    onKeyPress ì´ë²¤íŠ¸ë¥¼ ì´ìš©í•´ì„œ ì—”í„° í‚¤ë¥¼ ê°ì§€í•˜ë©´ ëœë‹¤.

    ```tsx
    // elements/Input.js

    import React from "react";
    import styled from "styled-components";

    import { Text, Grid } from "./index";

    const Input = (props) => {
      const {
        label,
        placeholder,
        _onChange,
        type,
        multiLine,
        value,
        is_submit,
        onSubmit,
      } = props;

      if (multiLine) {
        return (
          <Grid>
            {label && <Text margin="0px">{label}</Text>}
            <ElTextarea
              rows={10}
              value={value}
              placeholder={placeholder}
              onChange={_onChange}
            ></ElTextarea>
          </Grid>
        );
      }

      return (
        <React.Fragment>
          <Grid>
            {label && <Text margin="0px">{label}</Text>}
            {is_submit ? (
              <ElInput
                type={type}
                placeholder={placeholder}
                onChange={_onChange}
                value={value}
                onKeyPress={(e) => {
                  if(e.key === "Enter"){
                    onSubmit(e);
                  }
                }}
              />
            ) : (
              <ElInput type={type} placeholder={placeholder} onChange={_onChange} />
            )}
          </Grid>
        </React.Fragment>
      );
    };

    Input.defaultProps = {
      multiLine: false,
      label: false,
      placeholder: "í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.",
      type: "text",
      value: "",
      is_submit: false,
      onSubmit: () => {},
      _onChange: () => {},
    };

    const ElTextarea = styled.textarea`
      border: 1px solid #212121;
      width: 100%;
      padding: 12px 4px;
      box-sizing: border-box;
    `;

    const ElInput = styled.input`
      border: 1px solid #212121;
      width: 100%;
      padding: 12px 4px;
      box-sizing: border-box;
    `;

    export default Input;
    ```

## ëŒ“ê¸€ ì•Œë¦¼ ë±ƒì§€ ë§Œë“¤ê¸°

ë‚´ê°€ ì“´ ê²Œì‹œê¸€ì— ë‚´ê°€ ì•„ë‹Œ ì‚¬ëŒì´ ëŒ“ê¸€ì„ ì“°ë©´ ì•Œë ¤ì¤€ë‹¤.

ì•Œë¦¼ì„ ì½ì—ˆëŠ”ì§€ì— ëŒ€í•œ êµ¬ë¶„ìê°€ ìˆì–´ì•¼ í•œë‹¤.

- firebaseì˜ realtime database ì¶”ê°€í•˜ê¸°

    ```jsx
    // shared/firebase.js

    import firebase from "firebase/app";
    import "firebase/auth";
    import "firebase/firestore";
    import "firebase/storage";
    import "firebase/database";

    const firebaseConfig = {
      //ì¸ì¦ì •ë³´!
    };

    firebase.initializeApp(firebaseConfig);

    const apiKey = firebaseConfig.apiKey;
    const auth = firebase.auth();
    const firestore = firebase.firestore();
    const storage = firebase.storage();
    const realtime = firebase.database();

    export{auth, apiKey, firestore, storage, realtime};
    ```

- realtime database ë¦¬ìŠ¤ë„ˆ êµ¬ë…í•˜ê¸°

    ```jsx
    import React from "react";
    import { Badge } from "@material-ui/core";
    import NotificationsIcon from "@material-ui/icons/Notifications";

    import {realtime} from "../shared/firebase";
    import {useSelector} from "react-redux";

    const NotiBadge = (props) => {
      const [is_read, setIsRead] = React.useState(true);
      const user_id = useSelector(state => state.user.user.uid);
      const notiCheck = () => {
          props._onClick();
      };

      React.useEffect(() => {
        const notiDB = realtime.ref(`noti/${user_id}`);

        notiDB.on("value", (snapshot) => {
            console.log(snapshot.val());
            
            setIsRead(snapshot.val().read);
        });
      }, []);

      return (
        <React.Fragment>
          <Badge color="secondary" variant="dot" invisible={is_read} onClick={notiCheck}>
            <NotificationsIcon />
          </Badge>
        </React.Fragment>
      );
    };

    NotiBadge.defaultProps = {
      _onClick: () => {},
    };

    export default NotiBadge;
    ```

- êµ¬ë… í•´ì œë„ ì¶”ê°€í•˜ê¸°

    ```jsx
    React.useEffect(() => {
       ...
        // ë¦¬ìŠ¤ë„ˆë¥¼ í•´ì œí•©ì‹œë‹¤!
        return () => notiDB.off();
      }, []);
    ```

- í—¤ë” êµ¬í˜„í•˜ê¸°

    ```jsx
    ...
    import NotiBadge from "./NotiBadge";

    const Header = (props) => {
    ...
      if (is_login && is_session) {
        return (
          <React.Fragment>
            <Grid is_flex padding="4px 16px">
              <Grid>
                <Text margin="0px" size="24px" bold>
                  í—¬ë¡œ
                </Text>
              </Grid>

              <Grid is_flex>
                <Button text="ë‚´ì •ë³´"></Button>
                <NotiBadge _onClick={() => {
                  history.push("/noti");
                }}/>
                <Button
                  text="ë¡œê·¸ì•„ì›ƒ"
                  _onClick={() => {
                    dispatch(userActions.logoutFB());
                  }}
                ></Button>
              </Grid>
            </Grid>
          </React.Fragment>
        );
      }
    ...
    ```

- ëŒ“ê¸€ ë‹¬ì•˜ì„ ë•Œ ì•Œë¦¼ ì£¼ê¸°

    ```jsx
    // redux/modules/comment.js

    const addCommentFB = (post_id, contents) => {
      return function (dispatch, getState, { history }) {
        const commentDB = firestore.collection("comment");
        const user_info = getState().user.user;

        let comment = {
          post_id: post_id,
          user_id: user_info.uid,
          user_name: user_info.user_name,
          user_profile: user_info.user_profile,
          contents: contents,
          insert_dt: moment().format("YYYY-MM-DD hh:mm:ss"),
        };

        // firestoreì— ì½”ë©˜íŠ¸ ì •ë³´ë¥¼ ë„£ì–´ìš”!
        commentDB.add(comment).then((doc) => {
          const postDB = firestore.collection("post");
          comment = { ...comment, id: doc.id };

          // post ì •ë³´ ê°€ì ¸ì˜¤ê¸°!
          const post = getState().post.list.find((l) => l.id === post_id);

          //   firestoreì— ì €ì¥ëœ ê°’ì„ +1í•´ì¤ë‹ˆë‹¤!
          const increment = firebase.firestore.FieldValue.increment(1);

          // postì—ë„ comment_cntë¥¼ í•˜ë‚˜ í”ŒëŸ¬ìŠ¤ í•´ì¤ë‹ˆë‹¤.
          postDB
            .doc(post_id)
            .update({ comment_cnt: increment })
            .then((_post) => {
              // commentë¥¼ ì¶”ê°€í•´ì£¼ê³ ,
              dispatch(addComment(post_id, comment));

              // ë¦¬ë•ìŠ¤ì— postê°€ ìˆì„ ë•Œë§Œ postì˜ comment_cntë¥¼ +1í•´ì¤ë‹ˆë‹¤.
              if (post) {
                dispatch(
                  postActions.editPost(post_id, {
                    comment_cnt: parseInt(post.comment_cnt) + 1,
                  })
                );
                
                // ì•Œë¦¼ì´ ê°€ê²Œ í•´ì¤ë‹ˆë‹¤!
                const notiDB = realtime.ref(`noti/${post.user_info.user_id}`);
                // ì½ìŒ ìƒíƒœë¥¼ falseë¡œ ë°”ê¿”ì£¼ë©´ ë˜ê² ì£ !
                notiDB.update({ read: false});
              }
            });
        });
      };
    };
    ```

- ë…¸í‹° ì•„ì´ì½˜ ëˆ„ë¥´ë©´ ì½ìŒ ì²˜ë¦¬í•˜ê¸°

    ```jsx
    // components/NotiBadge.js
    	const notiCheck = () => {
        notiDB.update({ read: true });
        props._onClick();
      };
    ```

- ì•Œë¦¼ í˜ì´ì§€ êµ¬í˜„í•˜ê¸°

    ì•Œë¦¼ ë‚´ì—­ì—ëŠ” ëŒ“ê¸€ì„ ì“´ ìœ ì €ì˜ user_name, post_id, image_url, insert_dtê°€ í•„ìš”í•˜ë‹¤.

    ```jsx
    // redux/modules/comment.js
    const addCommentFB = (post_id, contents) => {
      return function (dispatch, getState, { history }) {
        ...

          // postì—ë„ comment_cntë¥¼ í•˜ë‚˜ í”ŒëŸ¬ìŠ¤ í•´ì¤ë‹ˆë‹¤.
          postDB
            .doc(post_id)
            .update({ comment_cnt: increment })
            .then((_post) => {
              // commentë¥¼ ì¶”ê°€í•´ì£¼ê³ ,
              dispatch(addComment(post_id, comment));

              // ë¦¬ë•ìŠ¤ì— postê°€ ìˆì„ ë•Œë§Œ postì˜ comment_cntë¥¼ +1í•´ì¤ë‹ˆë‹¤.
              if (post) {
                dispatch(
                  postActions.editPost(post_id, {
                    comment_cnt: parseInt(post.comment_cnt) + 1,
                  })
                );

                // ì•Œë¦¼ ë¦¬ìŠ¤íŠ¸ì— í•˜ë‚˜ë¥¼ ì¶”ê°€í•´ì¤ë‹ˆë‹¤!
                const _noti_item = realtime
                  .ref(`noti/${post.user_info.user_id}/list`)
                  .push();

                _noti_item.set({
                  post_id: post.id,
                  user_name: comment.user_name,
                  image_url: post.image_url,
                  insert_dt: comment.insert_dt
                }, (err) => {
                    if(err){
                        console.log('ì•Œë¦¼ ì €ì¥ ì‹¤íŒ¨');
                    }else{
                      // ì•Œë¦¼ì´ ê°€ê²Œ í•´ì¤ë‹ˆë‹¤!
                      const notiDB = realtime.ref(`noti/${post.user_info.user_id}`);
                      // ì½ìŒ ìƒíƒœë¥¼ falseë¡œ ë°”ê¿”ì£¼ë©´ ë˜ê² ì£ !
                      notiDB.update({ read: false });
                    }
                });
              }
            });
        });
      };
    };
    ```

- ì•Œë¦¼ í˜ì´ì§€ì—ì„œ ê°€ì ¸ì˜¤ê¸°

    ```jsx
    // pages/Notification.js
    import React from "react";
    import {Grid} from "../elements";
    import Card from "../components/Card";

    import {realtime} from "../shared/firebase";
    import {useSelector} from "react-redux";

    const Notification = (props) => {
      const [noti, setNoti] = React.useState([]);

        const user = useSelector(state => state.user.user);

        React.useEffect(() => {

          if(!user){
            return;
          }

          const notiDB = realtime.ref(`noti/${user.uid}/list`);
          
          // firebase realtime databaseëŠ” ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”!
          // ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ ì§ì ‘ ì—­ìˆœìœ¼ë¡œ ë‚´ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤!
          const _noti = notiDB.orderByChild("insert_dt");
          
          _noti.once('value', snapshot => {
            
            if(snapshot.exists()){
              let _data = snapshot.val();

              // reserse()ëŠ” ë°°ì—´ì„ ì—­ìˆœìœ¼ë¡œ ë’¤ì§‘ì–´ì¤˜ìš”.
              let _noti_list = Object.keys(_data).reverse().map(s => {
                return _data[s];
              });

              setNoti(_noti_list);
            }
            
          })
        }, [user]);

        return (
          <React.Fragment>
            <Grid padding="16px" bg="#EFF6FF">
              {noti.map((n, idx) => {
                return <Card {...n} key={`noti_${idx}`} />;
              })}
            </Grid>
          </React.Fragment>
        );
    }

    export default Notification;
    ```

- ì•Œë¦¼ì„ ëˆ„ë¥´ë©´ í¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ê¸°

    ```jsx
    // components/Card.js

    import React from "react";
    import { Grid, Text, Image } from "../elements";

    import {history} from "../redux/configureStore";

    const Card = (props) => {
      const { image_url, user_name, post_id } = props;

      return (
        <Grid
          padding="16px"
          is_flex
          bg="#ffffff"
          margin="8px 0px"
          _onClick={() => {history.push(`/post/${post_id}`);}}
        >
          <Grid width="auto" margin="0px 8px 0px 0px">
            <Image src={image_url} size={85} shape="square" />
          </Grid>
          <Grid>
            <Text>
              <b>{user_name}</b>ë‹˜ì´ ê²Œì‹œê¸€ì— ëŒ“ê¸€ì„ ë‚¨ê²¼ìŠµë‹ˆë‹¤ :)!{" "}
            </Text>
          </Grid>
        </Grid>
      );
    };

    Card.defaultProps = {
      image_url: "http://via.placeholder.com/400x300",
    };

    export default Card;
    ```

## SEO

ê²€ìƒ‰ ì—”ì§„ì—ì„œ ê²€ìƒ‰ ì‹œ ë‚´ê°€ ë§Œë“  ì›¹ì‚¬ì´íŠ¸ê°€ ê²€ìƒ‰ ê²°ê³¼ì— ë” ì˜ë³´ì´ê²Œ í•˜ê¸° ìœ„í•œ ê³¼ì •ì´ë‹¤.

ê²€ìƒ‰ ì—”ì§„ì´ ë‚´ ì‚¬ì´íŠ¸ì˜ htmlì„ í•œ ë²ˆ í›‘ì–´ê°€ê³ (í¬ë¡¤ë§), íŠ¹ì •í•œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ê²€ìƒ‰ ê²°ê³¼ì— ë³´ì—¬ì¤€ë‹¤.

ë¦¬ì•¡íŠ¸ëŠ” html íŒŒì¼ì´ 1ê°œ ë¿ì¸ ë°ë‹¤ê°€ ë Œë”ë§ ë˜ê¸° ì „ê¹Œì§€ëŠ” ë¹ˆ ê»ë°ê¸°ì´ê¸° ë•Œë¬¸ì— ê¸°ë³¸ì ìœ¼ë¡œ ê²€ìƒ‰ ì—”ì§„ì— ì˜¬ë¼ê°€ê¸° ì–´ë µë‹¤. ë”°ë¼ì„œ ê²€ìƒ‰ ì—”ì§„ì´ ê¸ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ ë¯¸ë¦¬ html íŒŒì¼ ë‚´ìš©ì„ ë³´ì—¬ì£¼ëŠ” ì‘ì—…ì„ í•´ì£¼ì–´ì•¼ í•œë‹¤.

ê²€ìƒ‰ ì—”ì§„ë§ˆë‹¤ í¬ë¡¤ë§í•˜ëŠ” ë°©ì‹ì´ ë‹¤ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ìš°ë¦¬ê°€ ì–´ë–¤ ê²€ìƒ‰ ì—”ì§„ì— ë…¸ì¶œë˜ê³  ì‹¶ì€ ì§€ë¥¼ ê²°ì •í•˜ê³ , í•´ë‹¹ ê²€ìƒ‰ ì—”ì§„ì´ ì œê³µí•˜ëŠ” SEO ê°€ì´ë“œì— ë§ì¶°ì„œ ì–´ë–¤ ë°©ë²•ì„ ì‚¬ìš©í•  ì§€ ì •í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

- meta-data ë„£ê¸° : ì›¹í˜ì´ì§€ì˜ ì œëª©ì´ë‚˜ ì´ë¯¸ì§€, ê°„ë‹¨í•œ ì„¤ëª…ì„ ê²€ìƒ‰ì—”ì§„ì— ì•Œë ¤ì£¼ëŠ” ì—­í• 

    ```tsx
    yarn add react-helmet
    ```

    - helmatìœ¼ë¡œ ë©”íƒ€ íƒœê·¸ ë°”ê¾¸ê¸° â†’ ë¹Œë“œ í›„ Postmanì—ì„œ í™•ì¸í•˜ê¸°

        ```tsx
        //One.js
        import React from "react";
        import {Helmet} from "react-helmet";
        const One = (props) => {
            return (
              <div>
                <Helmet>
                  <title>page one</title>
                  <meta property="og:title" content="page one" />
                  <meta property="og:description" content="hi there :) page one" />
                  <meta property="og:image" content="%PUBLIC_URL%/logo192.png" />
                </Helmet>
                <h2>Hi, there :) ! page one</h2>
                <button
                  onClick={() => {
                    props.history.push("/");
                  }}
                >
                  page one
                </button>
                <button
                  onClick={() => {
                    props.history.push("/two");
                  }}
                >
                  page two
                </button>
              </div>
            );
        }

        export default One;
        ```

- pre-rendering
- SSR

## Pre-rendering

ë¹Œë“œ ì‹œ html íŒŒì¼ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë‘ëŠ” ê²ƒ â†’ [react-snap](https://github.com/stereobooster/react-snap) ì‚¬ìš©

- í…ŒìŠ¤íŠ¸ìš© One, Two í˜ì´ì§€ ë§Œë“¤ê³ , ë¼ìš°íŠ¸ ì ìš©í•˜ê¸°

hydrate : ì •ì ìœ¼ë¡œ ë Œë”ë§ ëœ html ì»¨í…ì¸ ê°€ ì •ì ìœ¼ë¡œ ë™ì‘í•  ìˆ˜ ìˆë„ë¡ ì´ë²¤íŠ¸ë¥¼ ë³´ì¶©í•´ì£¼ëŠ” ì—­í• 

- hydrate ì‚¬ìš©í•˜ê¸°

    ```jsx
    import React from 'react';
    import ReactDOM, { hydrate } from "react-dom";
    ...

    const root = document.getElementById("root");

    if (root.hasChildNodes()) {
      hydrate(
          <App />,
        root
      );
    } else {
      ReactDOM.render(
        <App />,
        root
      );
    }
    ...
    ```

- package.jsonì˜ scriptsì—ì„œ postbuild ì¶”ê°€í•´ì£¼ê¸°

    ```jsx
    ...
    "scripts": {
        "start": "react-scripts start",
        "build": "react-scripts build",
        "test": "react-scripts test",
        "eject": "react-scripts eject",
        "postbuild": "react-snap"
      },
    ...
    "reactSnap": {
        "include": [
          "/two",
          "/"
        ]
      },
    ...
    ```

- ë¹Œë“œí•œ í”„ë¡œì íŠ¸ë¥¼ ë¡œì»¬ì—ì„œ ì‹¤í–‰í•´ë³´ê¸°

    ```tsx
    // serve.json
    {
      "rewrites": [
        { "source": "/", "destination": "/200.html" },
        { "source": "/two", "destination": "/two/index.html" }
      ]
    }
    ```

    ```tsx
    #í•œì¤„ì”© ì…ë ¥í•´ì£¼ì„¸ìš” :)
    yarn global add serve

    serve -c serve.json build
    ```

- htmlì— ë‚´ìš©ë¬¼ì´ ë“¤ì–´ì˜¤ëŠ”ì§€ Postmanìœ¼ë¡œ í™•ì¸í•˜ê¸°

## ì„±ëŠ¥ ì§€í‘œ ë³´ê¸°

"webVitals"ë¡œ ì›¹ì‚¬ì´íŠ¸ ì„±ëŠ¥ ì²´í¬ê°€ ê°€ëŠ¥í•˜ë‹¤.

- firebase analytics ì—°ê²°í•˜ê¸°
    - analytics ì—°ê²°í•˜ê¸°

        ```jsx
        ...
        import "firebase/analytics";

        const firebaseConfig = {
          // ì¸ì¦ ì •ë³´!
        };
        ...

        const analytics = firebase.analytics();

        export{auth, apiKey, firestore, storage, realtime, analytics};
        ```

    - ë¦¬í¬íŠ¸ ë³´ë‚´ê¸°

        ```jsx
        //index.js
        ...
        import { analytics } from "./shared/firebase";
        ...
        function sendToAnalytics(metric) {
          const _report = JSON.stringify(metric);

          analytics.logEvent("web_vital_report", _report);

          console.log({ _report });
        }
        reportWebVitals(sendToAnalytics);
        ```

    - í™•ì¸í•˜ê¸°

        ëŒ€ì‹œë³´ë“œì—ì„œ í™•ì¸í•´ë³¼ê¹Œìš”! ğŸ™‚ 

        ![%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A2%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%89%E1%85%B5%E1%86%B7%E1%84%92%E1%85%AA%E1%84%87%E1%85%A1%E1%86%AB%203919ac1335334519a0da4373744db222/_2021-03-23__9.41.03.png](%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A2%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%89%E1%85%B5%E1%86%B7%E1%84%92%E1%85%AA%E1%84%87%E1%85%A1%E1%86%AB%203919ac1335334519a0da4373744db222/_2021-03-23__9.41.03.png)

## ë Œë”ë§ íšŸìˆ˜ ì¤„ì´ê¸°

ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•˜ê³ , ê²°ê³¼ë¥¼ ë©”ëª¨ì´ì œì´ì…˜í•´ë‘ì–´ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ê°€ ë°”ë€” ë•Œë§ˆë‹¤ ë°”ë€” ê²Œ ì—†ëŠ” ì»´í¬ë„ŒíŠ¸ê¹Œì§€ ë‹¤ì‹œ ë Œë”ë§í•˜ëŠ” ê±¸ ë§‰ì•„ì¤„ ìˆ˜ ìˆë‹¤.

```tsx
// components/Post.js

import React from "react";
import { Grid, Image, Text, Button } from "../elements";

import {history} from "../redux/configureStore";

 const Post = React.memo((props) => {
   console.log("in post");
   return (
     <React.Fragment>
       ...
     </React.Fragment>
   );
 });
...
```

## ê°œì„ í•˜ê¸°

### ì„±ëŠ¥ ìµœì í™”

- ì‚¬ì´íŠ¸ ë¡œë”© ì†ë„ ê°œì„ í•˜ê¸°
    - ttfb ì¸¡ì •í•˜ê¸°
    - ë Œë”ë§ íšŸìˆ˜ ì¤„ì´ê¸°
    - ìë°”ìŠ¤í¬ë¦½íŠ¸ ë²ˆë“¤ ì‚¬ì´ì¦ˆë¥¼ ì¤„ì´ê¸° (code splitting)
- ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€í•˜ê¸°(ë™ì¼í•œ ìš”ì²­ì´ ì—¬ëŸ¬ ë²ˆ ì¼ì–´ë‚˜ì§€ ì•Šë„ë¡)
    - loadingì´ trueë©´ ë²„íŠ¼ì„ disableí•˜ê±°ë‚˜, api ìš”ì²­ì„ ëª»í•˜ê²Œ ë§‰ëŠ”ë‹¤.
- ì´ë¯¸ì§€ ìš©ëŸ‰ ì¤„ì´ê¸°
    - ì‚¬ìš©í•˜ëŠ” ê³³ì— ë§ê²Œ ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§•í•´ì„œ ì €ì¥í•˜ê¸°
    - .webpë¡œ í™•ì¥ìë¥¼ ë°”ê¾¸ì–´ ì €ì¥í•˜ê¸°
- cssë¡œ ì´ë¯¸ì§€ ìŠ¤í”„ë¼ì´íŠ¸ í•˜ê¸°
    - ì‘ì€ ì¡°ê° ì´ë¯¸ì§€ë“¤ì„ í•œ êµ°ë° ëª°ì•„ì„œ ë§Œë“¤ê³ , cssë¡œ ìª¼ê°œì„œ ì“°ê¸°

        â†’ background-position, background-image ì†ì„±ì„ ì´ìš©

### ì‚¬ìš©ì„± ëŒì–´ì˜¬ë¦¬ê¸°

ìš°ë¦¬ê°€ ë§Œë“  ì‚¬ì´íŠ¸ë¥¼ ì‰½ê²Œ ì“°ë„ë¡ ë§Œë“ ë‹¤.

- ì´ë¯¸ì§€ ì§€ì—° ë¡œë”©
    - ì´ë¯¸ì§€ê°€ 100% ë¡œë”©ë˜ê¸° ì „ê¹Œì§€ëŠ” íë¦¿í•œ ì´ë¯¸ì§€ë‚˜ íŠ¹ì • ìƒ‰ë§Œ ë³´ì—¬ì£¼ë‹¤ê°€ ì™„ì „íˆ ë¡œë“œë˜ë©´ ê°ˆì•„ë¼ìš´ë‹¤.
- ìŠ¤í”¼ë„ˆ ë‹¬ê¸°
    - ì‚¬ì´íŠ¸ë¥¼ ë‹¤ì‹œ ê·¸ë¦¬ëŠ” ê³¼ì •ì—ì„œ í…… ë¹ˆ í™”ë©´ì´ë‚˜ ì•„ì§ ë°ì´í„°ê°€ ì—†ì–´ì„œ ë¯¸ìš´ í™”ë©´ì„ ê°€ë¦´ ìˆ˜ ìˆë‹¤.

        â†’ [react-placeholder](https://github.com/buildo/react-placeholder)

- ì˜¤ë¥˜ í˜ì´ì§€ ë§Œë“¤ê¸°
- ë²¨ë¦¬ë°ì´ì…˜ ì²´í¬ ë¯¸ë¦¬ í•˜ê¸°
    - ì˜ëª»ëœ ë°ì´í„°ë¥¼ ë„˜ê²¨ì£¼ì§€ ì•Šë„ë¡ í•œë‹¤.