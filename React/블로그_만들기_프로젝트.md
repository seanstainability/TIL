# 블로그 만들기 프로젝트

정적 사이트 생성기, Gatsby를 이용하여 내 블로그 만들기

## JAM Stack

JavaScript, API, MarkUp Stack으로 이루어진 웹 구성 방식

더 빠르고, 안전하며, 스케일링하기 쉬운 웹을 만들기 위해 디자인된 아키텍처

기존 방식은 서버에서 데이터베이스 또는 CMS(Content Management System)로부터 추출한 데이터를 프론트엔드에 뿌려주는 방식 → 구조가 복잡

각종 마크업 요소와 다양한 API를 통해 만든 정적 웹 사이트를 Pre-Render하여 CDN(Content Delivery Network)을 통해 웹 사이트를 열람하는 방식 → 구조가 단순

브라우저에서 첫 응답을 받기까지 걸리는 시간인 TTFB(Time to First Byte)를 최소화하는 데 미리 빌드 된 파일을 CDN을 통해 제공하는 것보다 나은 방법이 없다.

정적 웹 사이트에서의 스케일링은 더 많은 지역에서 홈페이지를 제공할 수 있게 하는 의미인데, 미리 빌드 된 파일 제공을 담당하는 CDN이 그 역할을 충분히 수행한다.

### 개발 환경 구성하기

1. Gatsby 프로젝트 생성하기 : `npx gatsby-cli new "[프로젝트 명]"`
2. 로컬 서버 실행해보기 : `yarn develop`
3. 디렉토리 구조 잡기
    - root
        - contents : 블로그 포스트 저장
        - src
            - components : 리액트 컴포넌트 저장
            - hooks : 커스텀 훅 저장
            - pages : 페이지 컴포넌트 저장

                → 브라우저에서 pages 디렉토리에 있는 파일의 이름을 통해 페이지 접근 가능

            - templates : 같은 형식의 여러 콘텐츠를 보여주는 컴포넌트 저장
4. 불필요한 라이브러리 정리하기 : `yarn remove gatsby-plugin-manifest gatsby-plugin-gatsby-cloud`
    - PWA(Progressive Web Application)을 위한 라이브러리
    - Gatsby Cloud를 위한 라이브러리
5. 타입스크립트 설치하기 : `yarn add typescript --dev`
6. Gatsby에서 타입스크립트를 사용하기 위한 플러그인 설치하기 : `yarn add gatsby-plugin-typescript`
7. gatsby-config.js 파일 수정하기

    : 설치한 플러그인 추가하기

    ```tsx
    plugins: [
        {
          resolve: 'gatsby-plugin-typescript',
          options: {
            isTSX: true,
            allExtensions: true,
          },
        },
    ```

    : 마크다운 파일이 위치할 디렉토리 지정

    ```tsx
    // {
        //   resolve: `gatsby-source-filesystem`,
        //   options: {
        //     name: `contents`,
        //     path: `${__dirname}/contents`,
        //   },
        // },
    ```

8. 타입스크립트 설정을 위한 tsconfig.json 파일 생성 및 수정하기 : `yarn tsc --init`

    ```tsx
    {
      "compilerOptions": {
        "target": "es5",
        "module": "commonjs",
        "allowJs": true,
        "jsx": "preserve",
        "strict": true,
        "noUnusedLocals": true,
        "noUnusedParameters": true,
        "noImplicitReturns": true,
        "baseUrl": "./src",
        "paths": {
          "components/*": ["./components/*"],
          "utils/*": ["./utils/*"],
          "hooks/*": ["./hooks/*"]
        },
        "esModuleInterop": true,
        "skipLibCheck": true,
        "forceConsistentCasingInFileNames": true,
        "resolveJsonModule": true
      },
      "include": ["src/**/*.tsx"],
      "exclude": ["node_modules"]
    }
    ```

    `paths` 옵션을 사용하면 상대 경로가 아닌 절대 경로를 사용하기 위해 경로를 매핑해주는 옵션으로, 깔끔한 코드 작성이 가능하다. 이를 사용하기 위해서는 `baseUrl`을 작성해줘야 한다.

    여기까지만 하면 컴파일은 되지만 실제로 `paths` 옵션에 추가한 매핑 경로를 사용하기 위해서는 Webpack Config에도 추가해야 한다.

9. gatsby-node.js 파일에서 Webpack Config 추가하기

    ```tsx
    resolve: {
          alias: {
            components: path.resolve(__dirname, 'src/components'),
            utils: path.resolve(__dirname, 'src/utils'),
            hooks: path.resolve(__dirname, 'src/hooks'),
          },
        },
    ```

10. ESLint와 Prettier 설정하기

    각각 코드 검사 도구와 코드 정렬 도구

    ESLint를 통해 정의한 코드 작성 규칙을 기반으로 Prettier가 코드를 적절하게 변환해준다.

    : 관련 라이브러리 설치하기

    ```tsx
    yarn add eslint prettier eslint-config-prettier eslint-plugin-prettier @typescript-eslint/eslint-plugin@latest @typescript-eslint/parser@latest --dev
    ```

    : .eslintrc.json 파일 생성하기

    ```tsx
    {
      "env": {
        "browser": true,
        "es2021": true
      },
      "extends": [
        "eslint:recommended",
        "plugin:@typescript-eslint/eslint-recommended",
        "plugin:@typescript-eslint/recommended",
        "plugin:@typescript-eslint/recommended-requiring-type-checking",
        "plugin:prettier/recommended"
      ],
      "parser": "@typescript-eslint/parser",
      "parserOptions": {
        "ecmaFeatures": {
          "jsx": true
        },
        "ecmaVersion": 12,
        "sourceType": "module",
        "project": "./tsconfig.json"
      },
      "plugins": ["react", "@typescript-eslint"],
      "ignorePatterns": ["dist/", "node_modules/"],
      "rules": {}
    }
    ```

    → tsx 파일에서 문법 오류 확인이 가능해진다.

    : .prettierrc 파일 수정하기

    ```tsx
    {
      "printWidth": 80,
      "tabWidth": 2,
      "useTabs": false,
      "semi": true,
      "singleQuote": true,
      "quoteProps": "as-needed",
      "trailingComma": "all",
      "bracketSpacing": true,
      "arrowParens": "avoid",
      "endOfLine": "lf"
    }
    ```

    : 저장 시 자동으로 포맷팅되도록 VSCode 설정하기

    Preferences > Settings → Format On Save 체크 → JSON 파일을 아래와 같이 수정

    ```tsx
    {
      ...,
      "editor.codeActionsOnSave": {
        "source.fixAll": true
      },
      ...
    }
    ```